<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kooora Laghouat Live</title>
    
    <!-- Meta Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* تحسينات النبض */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 5px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .live-dot { animation: pulse-red 1.5s infinite; }
        
        /* إخفاء شريط التمرير للمظهر الجمالي */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* تحسين سلاسة التمرير */
        html { scroll-behavior: smooth; }
    </style>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 pb-safe">
    <div id="root"></div>

    <script type="text/babel">
        // --- إعدادات Firebase (نفس إعداداتك السابقة) ---
        const firebaseConfig = {
          apiKey: "AIzaSyAXLSZ5OqPEOnP0DUx3w75fU2xxiVkrWcE",
          authDomain: "koooralaghouat.firebaseapp.com",
          projectId: "koooralaghouat",
          storageBucket: "koooralaghouat.firebasestorage.app",
          messagingSenderId: "84750708348",
          appId: "1:84750708348:web:179ec7acf8fc2f357e23f9",
          measurementId: "G-4YSP7SWPGV"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- البيانات (مختصرة للعرض، الكود الكامل للفرق موجود في نسختك) ---
        // ملاحظة: استخدم نفس قائمة LEAGUES_DATA الموجودة في كودك الأصلي هنا.
        // سأضع متغير فارغ لتقوم بنسخ بياناتك داخله لعدم الإطالة.
        const LEAGUES_DATA = {
             "الجهوي الأول (فوج أ)": [
                { name: "ش ب عين اميناس", logo: "https://lrfouargla.com/uploads/images/logos/1(1).png" },
                { name: "ن.ر.تقنتورين", logo: "https://lrfouargla.com/uploads/images/logos/203-1601155957.png" },
                { name: "اتحاد الغرابة", logo: "https://lrfouargla.com/uploads/images/logos/sssx.png" },
                { name: "م .شباب .المخادمة", logo: "https://lrfouargla.com/uploads/images/logos/sz.png" },
                { name: "إتحاد بريان", logo: "https://lrfouargla.com/uploads/images/logos/47.png" },
                { name: "ترجي تقديدين", logo: "https://lrfouargla.com/uploads/images/logos/133.png" },
                { name: "و.ر.ب.الدبيلة", logo: "https://lrfouargla.com/uploads/images/logos/qqqqqq.png" },
                { name: "نادي بوغفالة", logo: "https://lrfouargla.com/uploads/images/logos/23.png" },
                { name: "المنظر الجميل", logo: "https://lrfouargla.com/uploads/images/logos/CSBV%20(1).png" },
                { name: "م.ك.أمل النزلة", logo: "https://lrfouargla.com/uploads/images/logos/sss%20%E2%80%AB%E2%80%AC.png" },
                { name: "إتحاد الرباح", logo: "https://lrfouargla.com/uploads/images/logos/73.png" },
                { name: "شباب سيدي بوعزيز", logo: "https://lrfouargla.com/uploads/images/logos/13.png" },
                { name: "شباب قصر الحيران", logo: "https://lrfouargla.com/uploads/images/logos/54.png" },
                { name: "إتحاد حاسي الدلاعة", logo: "https://lrfouargla.com/uploads/images/logos/53.png" }
            ],
            "الجهوي الأول (فوج ب)": [
                { name: "شباب قصر ورقلة", logo: "https://lrfouargla.com/uploads/images/logos/15826488_199664807171500_3091424271281007906_n.gif" },
                { name: "وفاق المغير", logo: "https://lrfouargla.com/uploads/images/logos/111.png" },
                { name: "اتحاد .ر. ب.الأغواط", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20241109-WA0007.jpg" },
                { name: "وفاق عين ماضي", logo: "https://lrfouargla.com/uploads/images/logos/125.png" },
                { name: "أمل سوف", logo: "https://lrfouargla.com/uploads/images/logos/88.png" },
                { name: "شباب نهقار", logo: "https://lrfouargla.com/uploads/images/logos/102.png" },
                { name: "هلال غرداية", logo: "https://lrfouargla.com/uploads/images/logos/75.png" },
                { name: "التضامن السوفي", logo: "https://lrfouargla.com/uploads/images/logos/72.png" },
                { name: "إ. الرباضي المنيعي", logo: "https://lrfouargla.com/uploads/images/logos/WhatsApp%20Image%202025-10-25%20%C3%A0%2022.02.03_23b4051f.jpg" },
                { name: "ش.أ.تمنراست", logo: "https://lrfouargla.com/uploads/images/logos/100.png" },
                { name: "إتحاد عين البيضاء", logo: "https://lrfouargla.com/uploads/images/logos/40.png" },
                { name: "وفاق مقر", logo: "https://lrfouargla.com/uploads/images/logos/38.png" },
                { name: "إ.الحمادين", logo: "https://lrfouargla.com/uploads/images/logos/168-1531611858.png" },
                { name: "نجم بوغفالة", logo: "https://lrfouargla.com/uploads/images/logos/NRNBO-02.png" }
            ],
            "الجهوي الثاني (فوج ج)": [
                { name: "م .ش .الثنية غرداية", logo: "https://lrfouargla.com/uploads/images/logos/449-1634476753.png" },
                { name: "مولودية البيضاء", logo: "https://lrfouargla.com/uploads/images/logos/46.png" },
                { name: "رائد المنيعة", logo: "https://lrfouargla.com/uploads/images/logos/7.png" },
                { name: "بن ناصر بن شهرة", logo: "https://lrfouargla.com/uploads/images/logos/49(1).png" },
                { name: "إ.ضاية بن ضحوة", logo: "https://lrfouargla.com/uploads/images/logos/57(1).png" },
                { name: "مستقبل لماضي", logo: "https://lrfouargla.com/uploads/images/logos/56.png" },
                { name: "رائد حاسي القارة", logo: "https://lrfouargla.com/uploads/images/logos/134.png" },
                { name: "عين سيدي علي", logo: "https://lrfouargla.com/uploads/images/logos/1528-1663416912.png" },
                { name: "نادي الأغواط", logo: "https://lrfouargla.com/uploads/images/logos/50.png" },
                { name: "إتحاد تاجموت", logo: "https://lrfouargla.com/uploads/images/logos/nirbt.png" },
                { name: "اتحاد.بريدة", logo: "https://lrfouargla.com/uploads/images/logos/2174-1665949908.png" },
                { name: "ترجي مرماد", logo: "https://lrfouargla.com/uploads/images/logos/51.png" },
                { name: "وداد زلفانة", logo: "https://lrfouargla.com/uploads/images/logos/t%C3%A9l%C3%A9chargement%20(1).jpg" },
                { name: "الاسماعيلي القرارة", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20231119-WA0010.jpg" },
                { name: "أمل سيدي بوزيد", logo: "https://lrfouargla.com/uploads/images/logos/49.png" },
                { name: "اتحاد شباب تاغيت", logo: "https://lrfouargla.com/uploads/images/logos/1855-1664293222.png" }
            ],
            "قسم ما بين الرابطات": [
                { name: "إتحاد النزلة", logo: "https://lirf.org.dz/uploads/images/logos/3.png" },
                { name: "نادي تقرت", logo: "https://lirf.org.dz/uploads/images/logos/received_257439396802495.jpeg" },
                { name: "أ متليلي الشعانبة", logo: "https://lirf.org.dz/uploads/images/logos/5.png" },
                { name: "اتحاد الخنق", logo: "https://lirf.org.dz/uploads/images/logos/IRBKheneg.png" },
                { name: "إتحاد الزاوية", logo: "https://lirf.org.dz/uploads/images/logos/6.png" },
                { name: "اتحاد آفلو", logo: "https://lirf.org.dz/uploads/images/logos/407-1656244680.png" },
                { name: "إتحاد همايسة", logo: "https://lirf.org.dz/uploads/images/logos/102.png" },
                { name: "مشعل حاسي مسعود", logo: "https://lirf.org.dz/uploads/images/logos/13.png" },
                { name: "شباب جامعة", logo: "https://lirf.org.dz/uploads/images/logos/39(1).png" },
                { name: "رائد قلتةس سعد", logo: "https://lirf.org.dz/uploads/images/logos/Gueltet%20Sidi%20Saad.png" },
                { name: "اولمبي الواد", logo: "https://lirf.org.dz/uploads/images/logos/Olympique%20El-Oued.png" },
                { name: "أولمبيك المقرن", logo: "https://lirf.org.dz/uploads/images/logos/8.png" },
                { name: "نجوم اليزي", logo: "https://lirf.org.dz/uploads/images/logos/16.png" },
                { name: "إتحاد حاسي الرمل", logo: "https://lirf.org.dz/uploads/images/logos/12.png" },
                { name: "اتحاد سوف", logo: "https://lirf.org.dz/uploads/images/logos/412-1715352850.png" },
                { name: "اتحاد ورقلة", logo: "https://lirf.org.dz/uploads/images/logos/414-1662939264.png" }
            ],
            "default": [
                { name: "فريق 1", logo: "" },
                { name: "فريق 2", logo: "" }
            ]
        };

        const { useState, useEffect } = React;

        // --- المكونات (Components) المحسنة للهاتف ---

        // 1. بطاقة المباراة (Mobile Card Design)
        const MatchCard = ({ match }) => {
            const isLive = match.status.includes('الشوط') && match.status !== 'نهاية الشوط الأول';
            const [currentTime, setCurrentTime] = useState("");

            useEffect(() => {
                const calculateTime = () => {
                    let totalSeconds = match.time * 60;
                    if (match.isRunning && match.lastStartTime) {
                        const diffSecs = Math.floor((Date.now() - match.lastStartTime) / 1000);
                        totalSeconds += diffSecs;
                    }
                    return `${Math.floor(totalSeconds / 60)}'`;
                };

                setCurrentTime(calculateTime());
                if (match.isRunning) {
                    const interval = setInterval(() => setCurrentTime(calculateTime()), 1000);
                    return () => clearInterval(interval);
                }
            }, [match.time, match.isRunning, match.lastStartTime]);

            let statusColor = "bg-slate-100 text-slate-500";
            if (isLive) statusColor = "bg-red-50 text-red-600 border-red-100";
            else if (match.status === 'نهاية المباراة') statusColor = "bg-emerald-50 text-emerald-600 border-emerald-100";
            else if (match.status === 'نهاية الشوط الأول') statusColor = "bg-orange-50 text-orange-600";

            return (
                <div className="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-3 relative overflow-hidden">
                    {/* شريط الحالة والوقت */}
                    <div className="flex justify-between items-center mb-4 text-xs font-bold">
                        <div className={`px-2 py-1 rounded-md border ${statusColor} flex items-center gap-1`}>
                            {isLive && <span className="w-2 h-2 rounded-full bg-red-600 live-dot"></span>}
                            <span>{match.status}</span>
                            {isLive && <span className="mr-1 font-mono">{currentTime}</span>}
                        </div>
                        {match.round && <span className="text-slate-400">جولة {match.round}</span>}
                    </div>

                    {/* تفاصيل الفريقين والنتيجة */}
                    <div className="flex items-center justify-between relative z-10">
                        {/* الفريق المستضيف */}
                        <div className="flex flex-col items-center w-[30%] text-center gap-2">
                            <img src={match.homeLogo} className="w-12 h-12 object-contain drop-shadow-sm" onError={(e)=>e.target.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'}/>
                            <span className="text-[11px] font-bold text-slate-800 leading-tight line-clamp-2 h-8">{match.home}</span>
                        </div>

                        {/* النتيجة */}
                        <div className="flex flex-col items-center justify-center w-[40%]">
                            {match.status !== 'لم تبدأ' ? (
                                <div className="flex items-center gap-2 bg-slate-50 px-4 py-2 rounded-xl border border-slate-100">
                                    <span className="text-2xl font-black text-slate-900">{match.scoreH}</span>
                                    <span className="text-slate-300">-</span>
                                    <span className="text-2xl font-black text-slate-900">{match.scoreA}</span>
                                </div>
                            ) : (
                                <span className="text-2xl font-bold text-slate-200 tracking-widest">VS</span>
                            )}
                        </div>

                        {/* الفريق الضيف */}
                        <div className="flex flex-col items-center w-[30%] text-center gap-2">
                            <img src={match.awayLogo} className="w-12 h-12 object-contain drop-shadow-sm" onError={(e)=>e.target.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'}/>
                            <span className="text-[11px] font-bold text-slate-800 leading-tight line-clamp-2 h-8">{match.away}</span>
                        </div>
                    </div>
                </div>
            );
        };

        const MatchListPublic = ({ matches }) => {
            if (matches.length === 0) return (
                <div className="flex flex-col items-center justify-center py-20 text-slate-300">
                    <p>لا توجد مباريات جارية</p>
                </div>
            );
            
            const grouped = matches.reduce((acc, m) => {
                (acc[m.league] = acc[m.league] || []).push(m);
                return acc;
            }, {});

            return (
                <div className="pb-20">
                    {Object.entries(grouped).map(([league, items]) => (
                        <div key={league} className="mb-6">
                            <div className="flex items-center gap-2 px-2 mb-3">
                                <span className="w-1 h-4 bg-emerald-500 rounded-full"></span>
                                <h3 className="text-sm font-bold text-slate-700">{league}</h3>
                            </div>
                            {items.map(m => <MatchCard key={m.id} match={m} />)}
                        </div>
                    ))}
                </div>
            );
        };

        // --- واجهة الأدمن (محسنة للموبايل أيضاً) ---
        const AdminPanel = ({ matches, user, setView }) => {
            const [league, setLeague] = useState('');
            const [home, setHome] = useState('');
            const [away, setAway] = useState('');
            const [homeLogo, setHomeLogo] = useState('');
            const [awayLogo, setAwayLogo] = useState('');
            const [round, setRound] = useState('1');

            const handleTeamSelect = (isHome, val) => {
                const list = LEAGUES_DATA[league] || LEAGUES_DATA['default'];
                const t = list.find(x => x.name === val);
                if(isHome) { setHome(val); setHomeLogo(t?.logo||''); }
                else { setAway(val); setAwayLogo(t?.logo||''); }
            };

            const addMatch = async () => {
                if(!league || !home || !away) return alert('أكمل البيانات');
                await db.collection("matches").add({
                    league, round, home, away, homeLogo, awayLogo, scoreH:0, scoreA:0, 
                    status:'لم تبدأ', time:0, isRunning:false, lastStartTime:null
                });
                alert('تم!');
            };

            return (
                <div className="pb-24 px-4 pt-4 bg-slate-100 min-h-screen">
                    <div className="bg-white p-4 rounded-xl shadow-sm mb-6 border border-emerald-100">
                        <h3 className="font-bold text-emerald-700 mb-3 text-sm">إضافة مباراة</h3>
                        <div className="space-y-3">
                            <select className="w-full p-3 bg-slate-50 rounded-lg text-sm border-none outline-none focus:ring-2 focus:ring-emerald-500" onChange={e=>setLeague(e.target.value)}>
                                <option value="">اختر البطولة</option>
                                {Object.keys(LEAGUES_DATA).filter(k=>k!=='default').map(k=><option key={k} value={k}>{k}</option>)}
                            </select>
                            <div className="flex gap-2">
                                <select className="flex-1 p-3 bg-slate-50 rounded-lg text-sm" onChange={e=>handleTeamSelect(true,e.target.value)}>
                                    <option value="">الفريق 1</option>
                                    {(LEAGUES_DATA[league]||[]).map(t=><option key={t.name} value={t.name}>{t.name}</option>)}
                                </select>
                                <select className="flex-1 p-3 bg-slate-50 rounded-lg text-sm" onChange={e=>handleTeamSelect(false,e.target.value)}>
                                    <option value="">الفريق 2</option>
                                    {(LEAGUES_DATA[league]||[]).map(t=><option key={t.name} value={t.name}>{t.name}</option>)}
                                </select>
                            </div>
                            <button onClick={addMatch} className="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-emerald-200">نشر المباراة</button>
                        </div>
                    </div>
                    
                    {/* قائمة التحكم السريع */}
                    <div className="space-y-4">
                        {matches.map(m => (
                            <div key={m.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <div className="flex justify-between items-center mb-3 text-xs text-slate-500">
                                    <span>{m.league}</span>
                                    <button onClick={()=>db.collection("matches").doc(m.id).delete()} className="text-red-500 bg-red-50 px-2 py-1 rounded">حذف</button>
                                </div>
                                <div className="flex items-center justify-between mb-4">
                                    <span className="text-[10px] font-bold w-16 text-center">{m.home}</span>
                                    <div className="flex gap-2">
                                        <input type="number" className="w-10 h-10 bg-slate-100 text-center font-bold rounded-lg" value={m.scoreH} 
                                            onChange={(e)=>db.collection("matches").doc(m.id).update({scoreH:Number(e.target.value)})}/>
                                        <input type="number" className="w-10 h-10 bg-slate-100 text-center font-bold rounded-lg" value={m.scoreA} 
                                            onChange={(e)=>db.collection("matches").doc(m.id).update({scoreA:Number(e.target.value)})}/>
                                    </div>
                                    <span className="text-[10px] font-bold w-16 text-center">{m.away}</span>
                                </div>
                                <div className="flex gap-2">
                                    <select className="flex-1 bg-slate-50 text-xs p-2 rounded" value={m.status} 
                                        onChange={(e)=>db.collection("matches").doc(m.id).update({status:e.target.value})}>
                                        <option>لم تبدأ</option>
                                        <option>الشوط الأول</option>
                                        <option>نهاية الشوط الأول</option>
                                        <option>الشوط الثاني</option>
                                        <option>نهاية المباراة</option>
                                    </select>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('public');
            const [user, setUser] = useState(null);
            const [matches, setMatches] = useState([]);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');

            useEffect(() => {
                auth.onAuthStateChanged(setUser);
                return db.collection("matches").onSnapshot(s => {
                    setMatches(s.docs.map(d => ({id:d.id, ...d.data()})));
                });
            }, []);

            // Header Component
            const Header = () => (
                <div className="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100 px-4 h-14 flex items-center justify-between shadow-sm">
                    <div className="flex items-center gap-2">
                        <img src="https://i.top4top.io/p_3636li6n50.jpg" className="w-8 h-8 rounded-full border border-emerald-100"/>
                        <span className="font-bold text-slate-800 tracking-tight">Kooora Laghouat</span>
                    </div>
                    <div className="flex gap-2">
                         {/* زر الفيسبوك */}
                         <a href="https://www.facebook.com/Kooralghouat" target="_blank" className="bg-blue-600 text-white p-1.5 rounded-full">
                            <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        </a>
                        <button onClick={()=>setView(user ? 'admin' : 'login')} className="bg-slate-100 p-1.5 rounded-full text-slate-600">
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        </button>
                    </div>
                </div>
            );

            // Login View
            if(view === 'login' && !user) return (
                <div className="min-h-screen flex items-center justify-center bg-white p-6">
                    <div className="w-full max-w-sm">
                        <h2 className="text-2xl font-bold text-center mb-8 text-emerald-800">تسجيل الدخول</h2>
                        <form onSubmit={(e)=>{e.preventDefault(); auth.signInWithEmailAndPassword(email, password).then(()=>setView('admin')).catch(()=>alert('خطأ'))}} className="space-y-4">
                            <input type="email" placeholder="البريد" className="w-full p-4 bg-slate-50 rounded-xl" value={email} onChange={e=>setEmail(e.target.value)}/>
                            <input type="password" placeholder="كلمة المرور" className="w-full p-4 bg-slate-50 rounded-xl" value={password} onChange={e=>setPassword(e.target.value)}/>
                            <button className="w-full py-4 bg-emerald-600 text-white font-bold rounded-xl shadow-lg">دخول</button>
                        </form>
                        <button onClick={()=>setView('public')} className="w-full mt-4 text-slate-400 text-sm">عودة للرئيسية</button>
                    </div>
                </div>
            );

            return (
                <div className="bg-slate-50 min-h-screen">
                    <Header />
                    
                    {view === 'admin' && user ? (
                        <AdminPanel matches={matches} user={user} setView={setView} />
                    ) : (
                        <div className="max-w-md mx-auto px-4 mt-6">
                            <div className="flex items-center gap-2 mb-4">
                                <span className="bg-red-500 w-2 h-2 rounded-full animate-ping"></span>
                                <h2 className="font-bold text-lg text-slate-800">مباريات اليوم</h2>
                            </div>
                            <MatchListPublic matches={matches} />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>