<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Firebase (Ù†Ø³Ø®Ø© Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù„Ù„Ø¹Ù…Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Ù…ÙƒØªØ¨Ø§Øª React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; }
        input, select { border: 2px solid #cbd5e1; padding: 0.6rem; border-radius: 0.5rem; width: 100%; margin-top: 0.2rem; }
        .admin-table th { background-color: #1e293b; color: white; padding: 12px; text-align: right; font-size: 0.8rem; border: 1px solid #334155; }
        .admin-table td { padding: 10px; border: 1px solid #e2e8f0; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ (ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­) ---
        const firebaseConfig = {
          apiKey: "AIzaSyBdlRDPTQqY8lZvD4R7nneXAwPgRbxmm14",
          authDomain: "councour-59e43.firebaseapp.com",
          projectId: "councour-59e43",
          storageBucket: "councour-59e43.firebasestorage.app",
          messagingSenderId: "492907661374",
          appId: "1:492907661374:web:31792fc3ab95d0e69ea96f",
          measurementId: "G-2NLB5H3NQH"
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const App = () => {
            const [view, setView] = useState('user'); 
            const [isLoggedIn, setIsLoggedIn] = useState(false);

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(user => setIsLoggedIn(!!user));
                return unsub;
            }, []);

            return (
                <div className="min-h-screen">
                    <nav className="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50 shadow-xl">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center font-black">M</div>
                            <h1 className="font-black text-lg">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h1>
                        </div>
                        <button 
                            onClick={() => setView(view === 'user' ? 'admin' : 'user')}
                            className="bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-lg font-bold text-sm transition shadow-lg"
                        >
                            {view === 'user' ? 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' : 'Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©'}
                        </button>
                    </nav>

                    {view === 'user' ? <UserForm /> : (isLoggedIn ? <AdminDashboard /> : <AdminLogin />)}
                </div>
            );
        };

        // --- 1. Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ---
        const UserForm = () => {
            const [loading, setLoading] = useState(false);
            const [success, setSuccess] = useState(false);
            const [formData, setFormData] = useState({
                nin: '', firstName: '', lastName: '', rank: '', subject: '',
                phone: '', email: '', birthDate: '', gpa: ''
            });

            const submitForm = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    await db.collection("candidates").add({
                        ...formData,
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setSuccess(true);
                } catch (err) {
                    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Firestore ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ (Rules)");
                } finally {
                    setLoading(false);
                }
            };

            if (success) return (
                <div className="max-w-md mx-auto mt-20 p-10 bg-white rounded-3xl shadow-2xl text-center border-t-8 border-green-500">
                    <div className="text-6xl mb-4">âœ…</div>
                    <h2 className="text-2xl font-black text-slate-800">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
                    <p className="text-slate-500 mt-2 font-bold">Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø¢Ù† Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</p>
                    <button onClick={() => setSuccess(false)} className="mt-6 bg-slate-800 text-white px-6 py-2 rounded-xl font-bold">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
                </div>
            );

            return (
                <div className="max-w-3xl mx-auto py-10 px-4">
                    <form onSubmit={submitForm} className="bg-white p-8 rounded-2xl shadow-xl space-y-4">
                        <div className="border-r-4 border-blue-600 pr-4 mb-6">
                            <h2 className="text-2xl font-black text-slate-800">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
                            <p className="text-sm text-slate-500 font-bold">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¨Ø¯Ù‚Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4">
                            <div className="md:col-span-2">
                                <label className="text-sm font-bold text-slate-600">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ·Ù†ÙŠ (NIN)</label>
                                <input type="text" required maxLength="18" className="bg-slate-50" onChange={e => setFormData({...formData, nin: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">Ø§Ù„Ø§Ø³Ù…</label>
                                <input type="text" required onChange={e => setFormData({...formData, firstName: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">Ø§Ù„Ù„Ù‚Ø¨</label>
                                <input type="text" required onChange={e => setFormData({...formData, lastName: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                                <input type="text" required placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³ØªØ§Ø° Ù…Ø¯Ø±Ø³Ø©" onChange={e => setFormData({...formData, rank: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">Ø§Ù„Ù…Ø§Ø¯Ø© / Ø§Ù„ØªØ®ØµØµ</label>
                                <input type="text" required onChange={e => setFormData({...formData, subject: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                                <input type="date" required onChange={e => setFormData({...formData, birthDate: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-slate-600">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" required placeholder="06XXXXXXXX" onChange={e => setFormData({...formData, phone: e.target.value})} />
                            </div>
                        </div>

                        <button type="submit" disabled={loading} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-xl mt-6 transition shadow-lg disabled:bg-slate-400">
                            {loading ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..." : "ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}
                        </button>
                    </form>
                </div>
            );
        };

        // --- 2. Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø§Ù„Ø¬Ø¯ÙˆÙ„) ---
        const AdminDashboard = () => {
            const [candidates, setCandidates] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");

            useEffect(() => {
                const unsubscribe = db.collection("candidates")
                    .orderBy("submittedAt", "desc")
                    .onSnapshot(snap => {
                        setCandidates(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                return unsubscribe;
            }, []);

            const filtered = candidates.filter(c => 
                (c.firstName + " " + c.lastName).includes(searchTerm) || c.nin.includes(searchTerm)
            );

            return (
                <div className="p-4 md:p-8">
                    <div className="bg-white p-6 rounded-2xl shadow-lg mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h2 className="text-2xl font-black text-slate-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
                            <p className="text-blue-600 font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©: {candidates.length}</p>
                        </div>
                        <input 
                            type="text" 
                            placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ..." 
                            className="max-w-sm shadow-inner bg-slate-50" 
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                        <button onClick={() => auth.signOut()} className="bg-red-50 text-red-600 px-4 py-2 rounded-lg font-bold border border-red-200">Ø®Ø±ÙˆØ¬</button>
                    </div>

                    <div className="bg-white rounded-xl shadow-2xl overflow-hidden border border-slate-200">
                        <div className="overflow-x-auto">
                            <table className="w-full admin-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                                        <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ (NIN)</th>
                                        <th>Ø§Ù„Ø±ØªØ¨Ø© ÙˆØ§Ù„ØªØ®ØµØµ</th>
                                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                        <th>ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filtered.map(c => (
                                        <tr key={c.id} className="hover:bg-blue-50 transition">
                                            <td className="font-bold text-slate-900">{c.firstName} {c.lastName}</td>
                                            <td className="font-mono text-xs text-blue-700 font-bold">{c.nin}</td>
                                            <td>
                                                <div className="font-bold">{c.rank}</div>
                                                <div className="text-[10px] text-slate-500">{c.subject}</div>
                                            </td>
                                            <td>{c.birthDate}</td>
                                            <td className="font-bold text-slate-700">{c.phone}</td>
                                            <td className="text-[10px] text-slate-400">
                                                {c.submittedAt?.toDate().toLocaleString('ar-DZ')}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        {filtered.length === 0 && (
                            <div className="p-20 text-center flex flex-col items-center">
                                <div className="text-5xl mb-4">ğŸ“‚</div>
                                <p className="text-slate-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- 3. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† ---
        const AdminLogin = () => {
            const [email, setEmail] = useState('');
            const [pass, setPass] = useState('');
            const [err, setErr] = useState('');

            const handleLogin = async (e) => {
                e.preventDefault();
                setErr('');
                try {
                    await auth.signInWithEmailAndPassword(email, pass);
                } catch (error) {
                    setErr("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
                }
            };

            return (
                <div className="max-w-md mx-auto mt-20 p-8 bg-white rounded-3xl shadow-2xl border-b-8 border-blue-600">
                    <h2 className="text-2xl font-black text-center text-slate-800 mb-6">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                    <form onSubmit={handleLogin} className="space-y-4">
                        <div>
                            <label className="text-xs font-black text-slate-500">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" placeholder="admin@example.com" required onChange={e => setEmail(e.target.value)} />
                        </div>
                        <div>
                            <label className="text-xs font-black text-slate-500">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required onChange={e => setPass(e.target.value)} />
                        </div>
                        {err && <p className="text-red-500 text-xs font-bold">{err}</p>}
                        <button className="w-full bg-slate-900 text-white font-black py-3 rounded-xl shadow-lg hover:bg-black transition">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
                    </form>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
