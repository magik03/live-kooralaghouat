<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة الإدارة الشاملة - د.عبد المجيد</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Compat Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Tajawal', 'sans-serif'] },
            colors: {
              'brand': '#008568',
              'brand-dark': '#006b54',
              'dark': '#0f172a',
            }
          },
        },
      }
    </script>
    <style>
      body { background-color: #f1f5f9; height: 100vh; overflow: hidden; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      
      .copy-hover { position: relative; transition: all 0.2s; cursor: pointer; }
      .copy-hover:hover { background-color: #f0fdf4; border-color: #008568; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
      .sidebar-item.active { background-color: #e2e8f0; border-right: 4px solid #008568; font-weight: bold; }
      .sidebar-item:hover { background-color: #f8fafc; }
      
      .section-header { 
        display: flex; 
        align-items: center; 
        gap: 0.5rem; 
        border-bottom: 2px solid #e2e8f0; 
        padding-bottom: 0.5rem; 
        margin-bottom: 1rem;
        color: #008568;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
        const { useState, useEffect } = React;

        // --- تهيئة Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyBdlRDPTQqY8lZvD4R7nneXAwPgRbxmm14",
            authDomain: "councour-59e43.firebaseapp.com",
            databaseURL: "https://councour-59e43-default-rtdb.firebaseio.com/", 
            projectId: "councour-59e43",
            storageBucket: "councour-59e43.firebasestorage.app",
            messagingSenderId: "492907661374",
            appId: "1:492907661374:web:31792fc3ab95d0e69ea96f"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const auth = firebase.auth();

        // --- Icons (SVG) ---
        const Icons = {
            Copy: () => <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            User: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            Briefcase: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v16"></path></svg>,
            Home: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
            GraduationCap: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>,
            BookOpen: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a4 4 0 0 0-4-4H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a4 4 0 0 1 4-4h6z"></path></svg>,
            Mail: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            LogOut: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
            Search: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Trash: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            FileSpreadsheet: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>,
            Check: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            X: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        // --- Toast Notification ---
        const Toast = ({ msg, show, type = 'success' }) => (
            <div className={`fixed bottom-5 left-5 px-6 py-3 rounded-lg shadow-xl transition-all duration-300 transform ${show ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'} ${type === 'error' ? 'bg-red-600' : 'bg-dark'} text-white`} style={{zIndex: 9999}}>
                <div className="flex items-center gap-2 font-bold">
                    {msg}
                </div>
            </div>
        );

        // --- Data Field Component ---
        const DataField = ({ label, value, onCopy }) => {
            if (!value && value !== 0) return null;
            return (
                <div 
                    onClick={() => onCopy(value)}
                    className="bg-white border border-gray-200 p-3 rounded-lg copy-hover relative group flex flex-col justify-center"
                    title="اضغط لنسخ المعلومة"
                >
                    <span className="text-xs text-gray-500 font-bold mb-1">{label}</span>
                    <span className="text-sm font-black text-gray-800 break-words leading-tight">{value}</span>
                    <div className="absolute top-2 left-2 text-brand opacity-0 group-hover:opacity-100 transition duration-200">
                        <Icons.Copy />
                    </div>
                </div>
            );
        };

        // --- Section Component ---
        const Section = ({ title, icon, children, gridCols = "grid-cols-1 md:grid-cols-2 lg:grid-cols-3" }) => (
            <div className="mb-8 bg-slate-50/50 p-1 rounded-xl">
                <div className="flex items-center gap-2 mb-4 border-b-2 border-gray-200 pb-2 text-brand px-2">
                    {icon}
                    <h3 className="text-xl font-black">{title}</h3>
                </div>
                <div className={`grid ${gridCols} gap-3`}>
                    {children}
                </div>
            </div>
        );

        // --- Login Screen ---
        const LoginScreen = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    setError('بيانات الدخول غير صحيحة');
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border-t-4 border-brand">
                        <h2 className="text-3xl font-black text-center mb-2 text-dark">نظام التوظيف</h2>
                        <p className="text-center text-gray-400 font-bold text-sm mb-8">تسجيل دخول المسؤول</p>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-600 mb-1">البريد الإلكتروني</label>
                                <input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full p-3 border rounded-lg font-bold focus:ring-2 focus:ring-brand focus:outline-none" placeholder="admin@example.com" required />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-600 mb-1">كلمة المرور</label>
                                <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full p-3 border rounded-lg font-bold focus:ring-2 focus:ring-brand focus:outline-none" placeholder="••••••••" required />
                            </div>
                            {error && <div className="bg-red-50 text-red-600 text-sm font-bold p-3 rounded-lg text-center border border-red-100">{error}</div>}
                            <button disabled={loading} className="w-full bg-brand text-white py-3.5 rounded-lg font-bold hover:bg-brand-dark transition-colors disabled:opacity-70 shadow-lg mt-2">
                                {loading ? 'جاري التحقق...' : 'دخول للوحة التحكم'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- Dashboard ---
        const Dashboard = () => {
            const [submissions, setSubmissions] = useState([]);
            const [selectedId, setSelectedId] = useState(null);
            const [search, setSearch] = useState('');
            const [toast, setToast] = useState({ show: false, msg: '', type: 'success' });
            const [loadingData, setLoadingData] = useState(true);

            // Fetch Data
            useEffect(() => {
                const ref = db.ref('submissions');
                const handleData = (snap) => {
                    const data = snap.val();
                    if (data) {
                        const list = Object.keys(data).map(k => ({id: k, ...data[k]}));
                        // Sort by date descending
                        list.sort((a, b) => new Date(b.submissionDate) - new Date(a.submissionDate));
                        setSubmissions(list);
                        // Auto select first
                        if (!selectedId && list.length > 0) setSelectedId(list[0].id);
                    } else {
                        setSubmissions([]);
                    }
                    setLoadingData(false);
                };
                
                ref.on('value', handleData);
                return () => ref.off();
            }, []); // Run once on mount

            const showToastMsg = (msg, type='success') => {
                setToast({ show: true, msg, type });
                setTimeout(() => setToast({ show: false, msg: '', type: 'success' }), 3000);
            };

            const copyToClipboard = (text) => {
                if (!text) return;
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToastMsg('تم النسخ!');
                } catch (err) {
                    showToastMsg('فشل النسخ', 'error');
                }
                document.body.removeChild(textArea);
            };

            const copyExcelRow = (d) => {
                const row = [
                    d.submissionDate,
                    d.firstNameAr, d.lastNameAr, d.nin,
                    d.rank, d.teachingSubject,
                    d.birthDate, d.birthWilaya,
                    d.phone, d.email,
                    d.degree, d.overallGpa,
                    d.status
                ].join('\t');
                copyToClipboard(row);
                showToastMsg('تم نسخ بيانات المترشح (Excel Format)');
            };

            const handleDelete = (id) => {
                if(confirm('تحذير: هل أنت متأكد من حذف هذا الملف نهائياً؟')) {
                    db.ref(`submissions/${id}`).remove();
                    if(selectedId === id) setSelectedId(null);
                    showToastMsg('تم حذف الملف', 'error');
                }
            };

            const updateStatus = (id, status) => {
                db.ref(`submissions/${id}`).update({status});
                showToastMsg(`تم تحديث الحالة إلى: ${status}`);
            };

            const filteredList = submissions.filter(s => 
                (s.firstNameAr + ' ' + s.lastNameAr).includes(search) || 
                (s.nin || '').includes(search) ||
                (s.rank || '').includes(search)
            );

            const selected = submissions.find(s => s.id === selectedId);

            return (
                <div className="flex h-screen font-sans overflow-hidden">
                    {/* Sidebar */}
                    <div className="w-1/3 min-w-[320px] max-w-sm bg-white border-l border-gray-200 flex flex-col shadow-xl z-20">
                        <div className="p-5 bg-dark text-white">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h1 className="font-black text-xl">المترشحين</h1>
                                    <span className="text-xs text-gray-400 font-bold">{submissions.length} ملف مسجل</span>
                                </div>
                                <button onClick={() => auth.signOut()} className="bg-white/10 hover:bg-white/20 p-2 rounded-lg transition" title="تسجيل خروج">
                                    <Icons.LogOut/>
                                </button>
                            </div>
                            <div className="relative">
                                <input 
                                    type="text" 
                                    placeholder="بحث (الاسم، الرقم، الرتبة)..." 
                                    value={search}
                                    onChange={e=>setSearch(e.target.value)}
                                    className="w-full p-3 pr-10 rounded-xl text-slate-900 font-bold focus:outline-none focus:ring-2 focus:ring-brand shadow-inner"
                                />
                                <div className="absolute top-3.5 right-3 text-slate-400"><Icons.Search /></div>
                            </div>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto bg-slate-50 p-2 space-y-2">
                            {loadingData && <div className="text-center py-10 text-gray-500 font-bold">جاري تحميل البيانات...</div>}
                            {!loadingData && filteredList.length === 0 && <div className="text-center py-10 text-gray-400 font-bold">لا توجد نتائج مطابقة</div>}
                            
                            {filteredList.map(s => (
                                <div 
                                    key={s.id} 
                                    onClick={() => setSelectedId(s.id)}
                                    className={`sidebar-item p-4 rounded-xl cursor-pointer border border-transparent transition-all duration-200 ${selectedId === s.id ? 'active bg-white shadow-md border-gray-200' : 'bg-white hover:bg-white/80'}`}
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <h3 className="font-black text-slate-800 text-sm md:text-base line-clamp-1">{s.firstNameAr} {s.lastNameAr}</h3>
                                        <span className={`text-[10px] px-2 py-0.5 rounded-full text-white font-bold whitespace-nowrap ${
                                            s.status === 'مقبول' ? 'bg-green-500' :
                                            s.status === 'مرفوض' ? 'bg-red-500' : 'bg-yellow-500'
                                        }`}>{s.status}</span>
                                    </div>
                                    <p className="text-xs font-bold text-slate-500 mb-2 truncate">{s.rank}</p>
                                    <div className="flex justify-between items-center border-t border-slate-100 pt-2">
                                        <span className="text-[10px] text-slate-400 font-mono font-bold">{s.submissionDate ? s.submissionDate.split(',')[0] : ''}</span>
                                        <span className="text-[10px] text-brand font-bold bg-green-50 px-2 py-0.5 rounded">{s.wilaya ? s.wilaya.split(' ')[1] : ''}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 bg-slate-100/50 overflow-y-auto p-4 md:p-8 relative scroll-smooth">
                        {selected ? (
                            <div className="max-w-6xl mx-auto pb-24 animate-[fadeIn_0.3s_ease-in-out]">
                                {/* Sticky Header */}
                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-200 sticky top-0 z-30 mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 backdrop-blur-md bg-white/95">
                                    <div>
                                        <div className="flex items-center gap-3">
                                            <h2 className="text-3xl font-black text-dark">{selected.firstNameAr} {selected.lastNameAr}</h2>
                                            <span className="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded border font-mono">{selected.nin}</span>
                                        </div>
                                        <p className="text-brand font-bold text-sm mt-1">{selected.teachingSubject} - {selected.rank}</p>
                                    </div>
                                    
                                    <div className="flex flex-wrap gap-2 w-full md:w-auto">
                                        <button onClick={() => copyExcelRow(selected)} className="bg-slate-800 hover:bg-black text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 shadow-lg hover:shadow-xl transition-all flex-1 md:flex-initial justify-center">
                                            <Icons.FileSpreadsheet /> <span>نسخ Excel</span>
                                        </button>
                                        <div className="hidden md:block w-px bg-gray-300 mx-1 h-8 self-center"></div>
                                        <button onClick={() => updateStatus(selected.id, 'مقبول')} className="bg-green-100 hover:bg-green-200 text-green-700 px-5 py-2.5 rounded-xl font-bold text-sm flex-1 md:flex-initial flex items-center justify-center gap-1 border border-green-200">
                                            <Icons.Check /> قبول
                                        </button>
                                        <button onClick={() => updateStatus(selected.id, 'مرفوض')} className="bg-red-100 hover:bg-red-200 text-red-700 px-5 py-2.5 rounded-xl font-bold text-sm flex-1 md:flex-initial flex items-center justify-center gap-1 border border-red-200">
                                            <Icons.X /> رفض
                                        </button>
                                        <button onClick={() => handleDelete(selected.id)} className="bg-white hover:bg-red-50 text-red-500 border border-red-200 px-3 rounded-xl transition-colors" title="حذف الملف"><Icons.Trash /></button>
                                    </div>
                                </div>

                                {/* 1. معلومات التعيين */}
                                <Section title="1. معلومات التعيين" icon={<Icons.Briefcase />}>
                                    <DataField label="المديرية" value={selected.wilaya} onCopy={copyToClipboard} />
                                    <DataField label="الرتبة المطلوبة" value={selected.rank} onCopy={copyToClipboard} />
                                    <DataField label="مادة التدريس" value={selected.teachingSubject} onCopy={copyToClipboard} />
                                </Section>

                                {/* 2. الهوية والمعلومات الشخصية (الشبكة الكبيرة) */}
                                <Section title="2. الهوية والمعلومات الشخصية" icon={<Icons.User />} gridCols="grid-cols-1 md:grid-cols-2 lg:grid-cols-4">
                                    <DataField label="رقم التعريف الوطني (NIN)" value={selected.nin} onCopy={copyToClipboard} />
                                    <DataField label="اللقب (عربي)" value={selected.lastNameAr} onCopy={copyToClipboard} />
                                    <DataField label="الاسم (عربي)" value={selected.firstNameAr} onCopy={copyToClipboard} />
                                    <DataField label="اللقب (لاتيني)" value={selected.lastNameLat} onCopy={copyToClipboard} />
                                    <DataField label="الاسم (لاتيني)" value={selected.firstNameLat} onCopy={copyToClipboard} />
                                    <DataField label="اسم الأب" value={selected.fatherName} onCopy={copyToClipboard} />
                                    <DataField label="لقب الأم" value={selected.motherLastName} onCopy={copyToClipboard} />
                                    <DataField label="اسم الأم" value={selected.motherFirstName} onCopy={copyToClipboard} />
                                    <DataField label="الجنس" value={selected.gender} onCopy={copyToClipboard} />
                                    <DataField label="الحالة العائلية" value={selected.maritalStatus} onCopy={copyToClipboard} />
                                    <DataField label="عدد الأولاد" value={selected.childrenCount} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ الميلاد" value={selected.birthDate} onCopy={copyToClipboard} />
                                    <DataField label="ولاية الميلاد" value={selected.birthWilaya} onCopy={copyToClipboard} />
                                    <DataField label="بلدية الميلاد" value={selected.birthCommune} onCopy={copyToClipboard} />
                                </Section>

                                {/* معلومات الزوجة (للمتزوجين) */}
                                {(selected.maritalStatus === 'متزوج(ة)' || selected.maritalStatus === 'مطلق(ة)' || selected.maritalStatus === 'أرمل(ة)') && (
                                    <div className="bg-pink-50 border-2 border-pink-100 p-6 rounded-2xl mb-8 shadow-sm">
                                        <h4 className="text-pink-800 font-black mb-4 flex items-center gap-2 text-lg">
                                            <Icons.User /> معلومات الزوج / الزوجة
                                        </h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <DataField label="اللقب (عربي)" value={selected.Spouse_Surname_Arabic} onCopy={copyToClipboard} />
                                            <DataField label="الاسم (عربي)" value={selected.Spouse_Name_Arabic} onCopy={copyToClipboard} />
                                            <DataField label="اللقب (لاتيني)" value={selected.Spouse_Surname_Latin} onCopy={copyToClipboard} />
                                            <DataField label="الاسم (لاتيني)" value={selected.Spouse_Name_Latin} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ الميلاد" value={selected.Spouse_Date_Of_Birth} onCopy={copyToClipboard} />
                                            <DataField label="مكان الميلاد" value={`${selected.Spouse_Birth_Baladiya || ''} - ${selected.Spouse_Birth_Wilaya || ''}`} onCopy={copyToClipboard} />
                                            <DataField label="رقم التعريف" value={selected.Spouse_NIN} onCopy={copyToClipboard} />
                                            <DataField label="اسم الأب" value={`${selected.Spouse_Father_Ar} / ${selected.Spouse_Father_Lt}`} onCopy={copyToClipboard} />
                                            <DataField label="اسم ولقب الأم" value={`${selected.Spouse_Mother_Name_Ar} ${selected.Spouse_Mother_Surname_Ar}`} onCopy={copyToClipboard} />
                                            <DataField label="المهنة" value={selected.Spouse_Professional_Status} onCopy={copyToClipboard} />
                                            <DataField label="الدخل الشهري" value={selected.Spouse_Monthly_Income} onCopy={copyToClipboard} />
                                            <DataField label="رقم الضمان" value={selected.Spouse_Social_Security_Number} onCopy={copyToClipboard} />
                                        </div>
                                    </div>
                                )}

                                {/* 3. مكان الإقامة والخدمة الوطنية */}
                                <Section title="3. مكان الإقامة والخدمة الوطنية" icon={<Icons.Home />}>
                                    <DataField label="ولاية الإقامة" value={selected.residenceWilaya} onCopy={copyToClipboard} />
                                    <DataField label="بلدية الإقامة" value={selected.residenceCommune} onCopy={copyToClipboard} />
                                    <DataField label="رقم الهاتف" value={selected.phone} onCopy={copyToClipboard} />
                                    <div className="md:col-span-3">
                                        <DataField label="العنوان الشخصي" value={selected.personalAddress} onCopy={copyToClipboard} />
                                    </div>
                                    {selected.gender === 'ذكر' && (
                                        <>
                                            <div className="md:col-span-3 h-px bg-gray-200 my-2"></div>
                                            <DataField label="وضعية الخدمة" value={selected.nationalServiceStatus} onCopy={copyToClipboard} />
                                            <DataField label="رقم الوثيقة" value={selected.nsRefNum} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ الإصدار" value={selected.nsIssueDate} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ الانتهاء" value={selected.nsExpiryDate} onCopy={copyToClipboard} />
                                            {selected.nationalServiceStatus === 'مؤدى' && (
                                                <>
                                                    <DataField label="تاريخ البداية" value={selected.nsStartDate} onCopy={copyToClipboard} />
                                                    <DataField label="تاريخ النهاية" value={selected.nsEndDate} onCopy={copyToClipboard} />
                                                </>
                                            )}
                                        </>
                                    )}
                                </Section>

                                {/* 4. الشهادات والمؤهلات والمسار الدراسي */}
                                <Section title="4. الشهادات والمؤهلات والمسار الدراسي" icon={<Icons.GraduationCap />}>
                                    <DataField label="الشهادة" value={selected.degree} onCopy={copyToClipboard} />
                                    <DataField label="التخصص" value={selected.degreeSpecialty} onCopy={copyToClipboard} />
                                    <DataField label="رقم الشهادة" value={selected.degreeCertNum} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ التخرج" value={selected.gradDate} onCopy={copyToClipboard} />
                                    <DataField label="المؤسسة المسلمة" value={selected.issuingInstitution} onCopy={copyToClipboard} />
                                    <DataField label="تقدير الشهادة" value={selected.degreeAppreciation} onCopy={copyToClipboard} />
                                    <DataField label="خريج مدرسة عليا؟" value={selected.isHigherSchoolGraduate} onCopy={copyToClipboard} />
                                    <DataField label="الأول في الدفعة؟" value={selected.isTopOfClass} onCopy={copyToClipboard} />
                                    
                                    {selected.isTopOfClass === 'نعم' && (
                                        <>
                                            <DataField label="رقم وثيقة التفوق" value={selected.topOfClassDocNum} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ الوثيقة" value={selected.topOfClassDocDate} onCopy={copyToClipboard} />
                                            <DataField label="جهة الإصدار" value={selected.topOfClassDocIssuer} onCopy={copyToClipboard} />
                                        </>
                                    )}
                                    
                                    <DataField label="المعدل العام للمسار" value={selected.overallGpa} onCopy={copyToClipboard} />
                                    <DataField label="علامة المذكرة" value={selected.thesisGrade} onCopy={copyToClipboard} />
                                </Section>

                                {/* المسار الدراسي السنوي */}
                                {selected.academicYears && (
                                    <div className="mb-6 p-5 bg-white border border-gray-200 rounded-2xl shadow-sm">
                                        <h4 className="font-black text-brand mb-4 text-sm flex items-center gap-2">
                                            <Icons.BookOpen /> المسار الدراسي السنوي
                                        </h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            {Object.entries(selected.academicYears).map(([k, v]) => (
                                                <div key={k} className="flex justify-between items-center bg-slate-50 p-3 rounded-xl text-sm border border-slate-100 hover:border-brand/30 transition">
                                                    <span className="font-black text-slate-700">سنة {k.replace('Year', '')}</span>
                                                    <div className="flex gap-3 text-xs font-bold text-slate-500">
                                                        <span>س1: {v.s1}</span>
                                                        <span>س2: {v.s2}</span>
                                                        <span className="text-white bg-brand px-2 py-0.5 rounded-md">{v.ann}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {selected.hasOtherDegrees === 'نعم' && (
                                    <Section title="شهادات عليا أخرى" icon={<Icons.GraduationCap />}>
                                        <DataField label="اسم الشهادة" value={selected.otherDegreeName} onCopy={copyToClipboard} />
                                        <DataField label="التخصص" value={selected.otherDegreeSpecialty} onCopy={copyToClipboard} />
                                        <DataField label="الجهة المسلمة" value={selected.otherDegreeIssuer} onCopy={copyToClipboard} />
                                        <DataField label="عدد السداسيات" value={selected.nmsemester} onCopy={copyToClipboard} />
                                        <DataField label="من سنة" value={selected.otherStartYear} onCopy={copyToClipboard} />
                                        <DataField label="إلى سنة" value={selected.otherEndYear} onCopy={copyToClipboard} />
                                    </Section>
                                )}

                                {/* 5. المنشورات */}
                                {selected.hasPublications === 'نعم' && (
                                    <Section title="5. المنشورات والأعمال المهنية" icon={<Icons.BookOpen />}>
                                        <DataField label="طبيعة العمل" value={selected.pubNature} onCopy={copyToClipboard} />
                                        <DataField label="تاريخ النشر" value={selected.pubDate} onCopy={copyToClipboard} />
                                        <DataField label="المجلة / الملتقى" value={selected.pubJournal} onCopy={copyToClipboard} />
                                        <DataField label="العدد / المجلد" value={selected.pubIssue} onCopy={copyToClipboard} />
                                        <div className="md:col-span-2"><DataField label="رابط النشر" value={selected.pubLink} onCopy={copyToClipboard} /></div>
                                    </Section>
                                )}

                                {/* 6. الخبرة المهنية */}
                                <Section title="6. الخبرة المهنية المكتسبة" icon={<Icons.Briefcase />}>
                                    <DataField label="هل لديك خبرة؟" value={selected.hasProfessionalExp} onCopy={copyToClipboard} />
                                    {selected.hasProfessionalExp === 'نعم' && (
                                        <>
                                            <div className="md:col-span-3"><DataField label="فئة الخبرة" value={selected.expType} onCopy={copyToClipboard} /></div>
                                            <DataField label="المنصب" value={selected.expJob} onCopy={copyToClipboard} />
                                            <DataField label="المؤسسة" value={selected.expInstitution} onCopy={copyToClipboard} />
                                            <DataField label="نوع الشهادة" value={selected.expCertType} onCopy={copyToClipboard} />
                                            <DataField label="رقم الشهادة/العقد" value={selected.expCertNum} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ الشهادة" value={selected.expCertDate} onCopy={copyToClipboard} />
                                            <DataField label="من تاريخ" value={selected.expStartDate} onCopy={copyToClipboard} />
                                            <DataField label="إلى تاريخ" value={selected.expEndDate} onCopy={copyToClipboard} />
                                            <DataField label="سبب التوقف" value={selected.expTerminationReason} onCopy={copyToClipboard} />
                                        </>
                                    )}
                                </Section>

                                {/* 7. الوضعية المهنية الحالية */}
                                <Section title="7. الوضعية المهنية الحالية" icon={<Icons.Briefcase />}>
                                    <DataField label="موظف حالياً؟" value={selected.hasJob} onCopy={copyToClipboard} />
                                    {selected.hasJob === 'نعم' && (
                                        <>
                                            <DataField label="الرتبة الحالية" value={selected.currentJobRank} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ أول تعيين" value={selected.firstAppointDate} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ التعيين الحالي" value={selected.currentRankDate} onCopy={copyToClipboard} />
                                            <DataField label="الصنف / الدرجة" value={selected.category} onCopy={copyToClipboard} />
                                            <DataField label="رقم المرجع" value={selected.jobRefNum} onCopy={copyToClipboard} />
                                            <DataField label="تاريخ المرجع" value={selected.jobRefDate} onCopy={copyToClipboard} />
                                            <DataField label="صفة السلطة" value={selected.signingAuthority} onCopy={copyToClipboard} />
                                            <DataField label="تسمية الإدارة" value={selected.adminName} onCopy={copyToClipboard} />
                                            <DataField label="هاتف الإدارة" value={selected.adminPhone} onCopy={copyToClipboard} />
                                            <DataField label="إيميل الإدارة" value={selected.adminEmail} onCopy={copyToClipboard} />
                                            <DataField label="عنوان الإدارة" value={selected.adminAddress} onCopy={copyToClipboard} />
                                        </>
                                    )}
                                </Section>

                                {/* 8. بيانات الاتصال */}
                                <Section title="8. بيانات الاتصال النهائية" icon={<Icons.Mail />}>
                                    <DataField label="البريد الإلكتروني الشخصي" value={selected.email} onCopy={copyToClipboard} />
                                </Section>

                            </div>
                        ) : (
                            <div className="flex flex-col items-center justify-center h-full text-slate-400 select-none opacity-50">
                                <div className="p-8 bg-white rounded-full shadow-sm mb-6 border-4 border-dashed border-slate-200">
                                    <Icons.Briefcase />
                                </div>
                                <p className="font-bold text-xl text-slate-500">اختر مترشحاً من القائمة الجانبية</p>
                                <p className="text-sm mt-2">سيتم عرض الملف الكامل هنا</p>
                            </div>
                        )}
                    </div>

                    <Toast msg={toast.msg} show={toast.show} type={toast.type} />
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            if (loading) return (
                <div className="h-screen flex items-center justify-center bg-slate-50">
                    <div className="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-brand"></div>
                </div>
            );
            return user ? <Dashboard /> : <LoginScreen />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>