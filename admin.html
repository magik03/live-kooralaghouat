<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة الإدارة الشاملة - د.عبد المجيد</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Tajawal', 'sans-serif'] },
            colors: {
              'brand': '#008568',
              'brand-dark': '#006b54',
              'dark': '#0f172a',
            }
          },
        },
      }
    </script>
    <style>
      body { background-color: #f1f5f9; height: 100vh; overflow: hidden; }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      
      .copy-hover { position: relative; transition: all 0.2s; cursor: pointer; }
      .copy-hover:hover { background-color: #f0fdf4; border-color: #008568; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
      .sidebar-item.active { background-color: #e2e8f0; border-right: 4px solid #008568; font-weight: bold; }
      .sidebar-item:hover { background-color: #f8fafc; }
      
      .section-header { 
        display: flex; 
        align-items: center; 
        gap: 0.5rem; 
        border-bottom: 2px solid #e2e8f0; 
        padding-bottom: 0.5rem; 
        margin-bottom: 1rem;
        color: #008568;
      }
      .edit-input {
        width: 100%;
        background: #f8fafc;
        border: 1px solid #008568;
        border-radius: 4px;
        padding: 4px;
        font-weight: 900;
        color: #000;
      }
      .filter-btn {
        font-size: 10px;
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
        background: #fff;
        color: #64748b;
        transition: all 0.2s;
        white-space: nowrap;
      }
      .filter-btn.active {
        background: #008568;
        color: #fff;
        border-color: #008568;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyBdlRDPTQqY8lZvD4R7nneXAwPgRbxmm14",
            authDomain: "councour-59e43.firebaseapp.com",
            databaseURL: "https://councour-59e43-default-rtdb.firebaseio.com/", 
            projectId: "councour-59e43",
            storageBucket: "councour-59e43.firebasestorage.app",
            messagingSenderId: "492907661374",
            appId: "1:492907661374:web:31792fc3ab95d0e69ea96f"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const auth = firebase.auth();

        const Icons = {
            Copy: () => <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            User: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            Briefcase: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v16"></path></svg>,
            Home: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
            GraduationCap: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>,
            BookOpen: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a4 4 0 0 0-4-4H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a4 4 0 0 1 4-4h6z"></path></svg>,
            Mail: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            LogOut: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
            Trash: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Edit: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            Save: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            Stats: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="18" y="3" width="4" height="18"></rect><rect x="10" y="8" width="4" height="13"></rect><rect x="2" y="13" width="4" height="8"></rect></svg>
        };

        const Toast = ({ msg, show, type = 'success' }) => (
            <div className={`fixed bottom-5 left-5 px-6 py-3 rounded-lg shadow-xl transition-all duration-300 transform ${show ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'} ${type === 'error' ? 'bg-red-600' : 'bg-dark'} text-white`} style={{zIndex: 9999}}>
                <div className="flex items-center gap-2 font-bold">{msg}</div>
            </div>
        );

        const DataField = ({ label, value, name, onCopy, isEditing, onEditChange, type="text" }) => {
            if (!isEditing && !value && value !== 0) return null;
            return (
                <div onClick={() => !isEditing && onCopy(value)} className={`bg-white border border-gray-200 p-3 rounded-lg relative group flex flex-col justify-center ${!isEditing ? 'copy-hover' : ''}`}>
                    <span className="text-xs text-gray-500 font-bold mb-1">{label}</span>
                    {isEditing ? (
                        <input type={type} className="edit-input" value={value || ''} onChange={(e) => onEditChange(name, e.target.value)} />
                    ) : (
                        <span className="text-sm font-black text-gray-800 break-words leading-tight">{value}</span>
                    )}
                    {!isEditing && (
                        <div className="absolute top-2 left-2 text-brand opacity-0 group-hover:opacity-100 transition duration-200">
                            <Icons.Copy />
                        </div>
                    )}
                </div>
            );
        };

        const Section = ({ title, icon, children, gridCols = "grid-cols-1 md:grid-cols-2 lg:grid-cols-3" }) => (
            <div className="mb-8 bg-slate-50/50 p-1 rounded-xl">
                <div className="flex items-center gap-2 mb-4 border-b-2 border-gray-200 pb-2 text-brand px-2">
                    {icon}
                    <h3 className="text-xl font-black">{title}</h3>
                </div>
                <div className={`grid ${gridCols} gap-3`}>{children}</div>
            </div>
        );

        const LoginScreen = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const handleLogin = async (e) => {
                e.preventDefault();
                try { await auth.signInWithEmailAndPassword(email, password); } catch (err) { setError('بيانات الدخول غير صحيحة'); }
            };
            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border-t-4 border-brand">
                        <h2 className="text-3xl font-black text-center mb-8 text-dark">نظام التوظيف</h2>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full p-3 border rounded-lg font-bold text-right" placeholder="البريد الإلكتروني" required />
                            <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full p-3 border rounded-lg font-bold text-right" placeholder="كلمة المرور" required />
                            {error && <div className="bg-red-50 text-red-600 text-sm font-bold p-3 rounded-lg text-center">{error}</div>}
                            <button className="w-full bg-brand text-white py-3.5 rounded-lg font-bold">دخول للوحة التحكم</button>
                        </form>
                    </div>
                </div>
            );
        };

        const Dashboard = () => {
            const [submissions, setSubmissions] = useState([]);
            const [selectedId, setSelectedId] = useState(null);
            const [search, setSearch] = useState('');
            const [filterStatus, setFilterStatus] = useState('الكل');
            const [toast, setToast] = useState({ show: false, msg: '', type: 'success' });
            const [isEditing, setIsEditing] = useState(false);
            const [editBuffer, setEditBuffer] = useState({});

            const statusesList = ['الكل', 'تم تسجيل', 'ملف ناقص', 'جاري معالجة في منصة', 'مقبول في منصة', 'غير مقبول في منصة'];

            useEffect(() => {
                const ref = db.ref('submissions');
                ref.on('value', (snap) => {
                    const data = snap.val();
                    if (data) {
                        const list = Object.keys(data).map(k => ({id: k, ...data[k]}));
                        list.sort((a, b) => new Date(b.submissionDate) - new Date(a.submissionDate));
                        setSubmissions(list);
                        if (!selectedId && list.length > 0) setSelectedId(list[0].id);
                    }
                });
                return () => ref.off();
            }, []);

            const showToastMsg = (msg, type='success') => {
                setToast({ show: true, msg, type });
                setTimeout(() => setToast({ show: false, msg: '', type: 'success' }), 3000);
            };

            const copyToClipboard = (text) => {
                if (!text) return;
                navigator.clipboard.writeText(text);
                showToastMsg('تم النسخ!');
            };

            const updateStatus = (id, status) => {
                db.ref(`submissions/${id}`).update({status});
                showToastMsg(`تم التحديث: ${status}`);
            };

            const handleDelete = (id) => {
                if(confirm('حذف نهائي؟')) {
                    db.ref(`submissions/${id}`).remove();
                    setSelectedId(null);
                    showToastMsg('تم الحذف', 'error');
                }
            };

            const handleStartEdit = () => {
                setEditBuffer({...selected});
                setIsEditing(true);
            };

            const handleEditChange = (name, value) => {
                setEditBuffer(prev => ({...prev, [name]: value}));
            };

            const handleSaveEdit = async () => {
                try {
                    await db.ref(`submissions/${selectedId}`).update(editBuffer);
                    setIsEditing(false);
                    showToastMsg('تم حفظ التعديلات بنجاح');
                } catch (e) {
                    showToastMsg('فشل الحفظ', 'error');
                }
            };

            const selected = submissions.find(s => s.id === selectedId);
            const displayData = isEditing ? editBuffer : selected;

            const filteredList = submissions.filter(s => {
                const fullName = (s.firstNameAr || '') + ' ' + (s.lastNameAr || '');
                const matchesSearch = fullName.includes(search) || (s.nin || '').includes(search);
                const currentStatus = s.status || 'ملف قيد الانتظار';
                const matchesFilter = filterStatus === 'الكل' || currentStatus === filterStatus;
                return matchesSearch && matchesFilter;
            });

            // إحصائيات سريعة للسايدبار
            const acceptedCount = submissions.filter(s => s.status === 'مقبول في منصة').length;
            const waitingCount = submissions.filter(s => !s.status || s.status === 'تم تسجيل').length;

            return (
                <div className="flex h-screen font-sans overflow-hidden text-right">
                    {/* Sidebar */}
                    <div className="w-1/3 min-w-[350px] max-w-md bg-white border-l border-gray-200 flex flex-col shadow-xl z-20">
                        <div className="p-4 bg-dark text-white">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="font-black text-lg flex items-center gap-2"><Icons.Stats /> لوحة التحكم ({submissions.length})</h1>
                                <button onClick={() => auth.signOut()} className="hover:text-red-400 transition-colors"><Icons.LogOut/></button>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2 mb-4">
                                <div className="bg-emerald-600/20 p-2 rounded-lg text-emerald-400 text-[10px] font-black border border-emerald-600/30 text-center">مقبول: {acceptedCount}</div>
                                <div className="bg-orange-600/20 p-2 rounded-lg text-orange-400 text-[10px] font-black border border-orange-600/30 text-center">انتظار: {waitingCount}</div>
                            </div>

                            <input type="text" placeholder="بحث بالإسم أو NIN..." value={search} onChange={e=>setSearch(e.target.value)} className="w-full p-2.5 rounded-lg text-slate-900 font-bold outline-none text-sm mb-3 text-right" />
                            
                            <div className="flex flex-wrap gap-1.5 overflow-x-auto pb-1 justify-end">
                                {statusesList.map(st => (
                                    <button key={st} onClick={() => setFilterStatus(st)} className={`filter-btn ${filterStatus === st ? 'active' : ''}`}>{st}</button>
                                ))}
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto bg-slate-50 p-2 space-y-2">
                            {filteredList.map(s => (
                                <div key={s.id} onClick={() => { setSelectedId(s.id); setIsEditing(false); }} className={`sidebar-item p-4 rounded-xl cursor-pointer border transition-all ${selectedId === s.id ? 'active bg-white shadow-md' : 'bg-white'}`}>
                                    <div className="flex justify-between items-start">
                                        <h3 className="font-black text-slate-800 text-sm">{s.firstNameAr} {s.lastNameAr}</h3>
                                        <span className={`text-[9px] px-2 py-0.5 rounded-full text-white font-bold ${
                                            s.status === 'مقبول في منصة' ? 'bg-emerald-500' :
                                            s.status === 'غير مقبول في منصة' ? 'bg-rose-600' :
                                            s.status === 'جاري معالجة في منصة' ? 'bg-sky-500' :
                                            s.status === 'تم تسجيل' ? 'bg-green-600' :
                                            s.status === 'ملف ناقص' ? 'bg-red-600' : 'bg-blue-500'
                                        }`}>{s.status || 'ملف قيد الانتظار'}</span>
                                    </div>
                                    <p className="text-xs font-bold text-slate-500 mt-1">{s.rank}</p>
                                    <p className="text-[10px] text-slate-400 mt-1">{s.submissionDate}</p>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Main Content Area */}
                    <div className="flex-1 bg-slate-100/50 overflow-y-auto p-8 relative">
                        {selected ? (
                            <div className="max-w-6xl mx-auto pb-24">
                                {/* Header Info Bar - يحتوي على الإيميل والباسورد للنسخ السريع */}
                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-200 sticky top-0 z-30 mb-8 flex flex-col md:flex-row justify-between items-center gap-4 backdrop-blur-md bg-white/95">
                                    <div className="flex flex-col gap-1 w-full md:w-auto">
                                        <h2 className="text-2xl font-black text-dark">{selected.firstNameAr} {selected.lastNameAr}</h2>
                                        <div className="flex gap-4 mt-2 justify-end">
                                            <div onClick={() => copyToClipboard(selected.email)} className="bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200 cursor-pointer hover:bg-brand hover:text-white transition-colors flex items-center gap-2">
                                                <span className="text-[10px] font-bold">الإيميل:</span>
                                                <span className="text-xs font-black">{selected.email}</span>
                                                <Icons.Copy />
                                            </div>
                                            <div onClick={() => copyToClipboard(selected.phone)} className="bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200 cursor-pointer hover:bg-brand hover:text-white transition-colors flex items-center gap-2">
                                                <span className="text-[10px] font-bold">الباسورد:</span>
                                                <span className="text-xs font-black">{selected.phone}</span>
                                                <Icons.Copy />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex flex-wrap gap-2 justify-center md:justify-end">
                                        {isEditing ? (
                                            <button onClick={handleSaveEdit} className="bg-brand text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 text-xs"><Icons.Save /> حفظ</button>
                                        ) : (
                                            <button onClick={handleStartEdit} className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 text-xs"><Icons.Edit /> تعديل</button>
                                        )}
                                        <button onClick={() => updateStatus(selected.id, 'تم تسجيل')} className="bg-green-100 text-green-700 border border-green-200 px-3 py-2 rounded-lg font-bold text-xs">تم تسجيل</button>
                                        <button onClick={() => updateStatus(selected.id, 'ملف ناقص')} className="bg-red-100 text-red-700 border border-red-200 px-3 py-2 rounded-lg font-bold text-xs">ملف ناقص</button>
                                        <button onClick={() => updateStatus(selected.id, 'جاري معالجة في منصة')} className="bg-sky-100 text-sky-700 border border-sky-300 px-3 py-2 rounded-lg font-bold text-xs">جاري معالجة في منصة</button>
                                        <button onClick={() => updateStatus(selected.id, 'مقبول في منصة')} className="bg-emerald-100 text-emerald-700 border border-emerald-300 px-3 py-2 rounded-lg font-bold text-xs">مقبول في منصة</button>
                                        <button onClick={() => updateStatus(selected.id, 'غير مقبول في منصة')} className="bg-rose-100 text-rose-700 border border-rose-300 px-3 py-2 rounded-lg font-bold text-xs">غير مقبول في منصة</button>
                                        <button onClick={() => handleDelete(selected.id)} className="text-red-500 p-2 hover:bg-red-50 rounded-full"><Icons.Trash /></button>
                                    </div>
                                </div>

                                {/* 1. معلومات التعيين */}
                                <Section title="1. معلومات التعيين" icon={<Icons.Briefcase />}>
                                    <DataField label="المديرية" name="wilaya" value={displayData.wilaya} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الرتبة المطلوبة" name="rank" value={displayData.rank} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="مادة التدريس" name="teachingSubject" value={displayData.teachingSubject} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* 2. الهوية والمعلومات الشخصية */}
                                <Section title="2. الهوية والمعلومات الشخصية" icon={<Icons.User />} gridCols="grid-cols-1 md:grid-cols-2 lg:grid-cols-4">
                                    <DataField label="NIN" name="nin" value={displayData.nin} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم شهادة الميلاد" name="birthCertNum" value={displayData.birthCertNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="اللقب (عربي)" name="lastNameAr" value={displayData.lastNameAr} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الاسم (عربي)" name="firstNameAr" value={displayData.firstNameAr} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="اللقب (لاتيني)" name="lastNameLat" value={displayData.lastNameLat} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الاسم (لاتيني)" name="firstNameLat" value={displayData.firstNameLat} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="اسم الأب" name="fatherName" value={displayData.fatherName} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="لقب الأم" name="motherLastName" value={displayData.motherLastName} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="اسم الأم" name="motherFirstName" value={displayData.motherFirstName} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الجنس" name="gender" value={displayData.gender} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الحالة العائلية" name="maritalStatus" value={displayData.maritalStatus} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="عدد الأولاد" name="childrenCount" value={displayData.childrenCount} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ الميلاد" name="birthDate" value={displayData.birthDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="ولاية الميلاد" name="birthWilaya" value={displayData.birthWilaya} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="بلدية الميلاد" name="birthCommune" value={displayData.birthCommune} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* معلومات الزوج / الزوجة */}
                                {(selected.maritalStatus && selected.maritalStatus !== 'أعزب(ة)') && (
                                    <Section title="معلومات الزوج / الزوجة" icon={<Icons.User />} gridCols="grid-cols-1 md:grid-cols-2 lg:grid-cols-4">
                                        <DataField label="اللقب (عربي)" name="Spouse_Surname_Arabic" value={displayData.Spouse_Surname_Arabic} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="الاسم (عربي)" name="Spouse_Name_Arabic" value={displayData.Spouse_Name_Arabic} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="اللقب (لاتيني)" name="Spouse_Surname_Latin" value={displayData.Spouse_Surname_Latin} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="الاسم (لاتيني)" name="Spouse_Name_Latin" value={displayData.Spouse_Name_Latin} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="تاريخ الميلاد" name="Spouse_Date_Of_Birth" value={displayData.Spouse_Date_Of_Birth} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                        <DataField label="بلدية الميلاد" name="Spouse_Birth_Baladiya" value={displayData.Spouse_Birth_Baladiya} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="ولاية الميلاد" name="Spouse_Birth_Wilaya" value={displayData.Spouse_Birth_Wilaya} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="NIN الزوج" name="Spouse_NIN" value={displayData.Spouse_NIN} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="اسم الأب (ع)" name="Spouse_Father_Ar" value={displayData.Spouse_Father_Ar} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="اسم الأم (ع)" name="Spouse_Mother_Name_Ar" value={displayData.Spouse_Mother_Name_Ar} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="لقب الأم (ع)" name="Spouse_Mother_Surname_Ar" value={displayData.Spouse_Mother_Surname_Ar} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="المهنة" name="Spouse_Professional_Status" value={displayData.Spouse_Professional_Status} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="الدخل الشهري" name="Spouse_Monthly_Income" value={displayData.Spouse_Monthly_Income} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="رقم الضمان" name="Spouse_Social_Security_Number" value={displayData.Spouse_Social_Security_Number} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    </Section>
                                )}

                                {/* 3. مكان الإقامة والخدمة الوطنية */}
                                <Section title="3. مكان الإقامة والخدمة الوطنية" icon={<Icons.Home />}>
                                    <DataField label="ولاية الإقامة" name="residenceWilaya" value={displayData.residenceWilaya} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="بلدية الإقامة" name="residenceCommune" value={displayData.residenceCommune} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم الهاتف" name="phone" value={displayData.phone} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="العنوان الشخصي" name="personalAddress" value={displayData.personalAddress} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="وضعية الخدمة" name="nationalServiceStatus" value={displayData.nationalServiceStatus} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم المرجع" name="nsRefNum" value={displayData.nsRefNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ الإصدار" name="nsIssueDate" value={displayData.nsIssueDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ الانتهاء" name="nsExpiryDate" value={displayData.nsExpiryDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ البداية" name="nsStartDate" value={displayData.nsStartDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ النهاية" name="nsEndDate" value={displayData.nsEndDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                </Section>

                                {/* 4. الشهادات والمؤهلات والمسار الدراسي */}
                                <Section title="4. الشهادات والمؤهلات والمسار الدراسي" icon={<Icons.GraduationCap />}>
                                    <DataField label="الشهادة" name="degree" value={displayData.degree} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="التخصص" name="degreeSpecialty" value={displayData.degreeSpecialty} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم الشهادة" name="degreeCertNum" value={displayData.degreeCertNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تقدير الشهادة" name="degreeAppreciation" value={displayData.degreeAppreciation} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ التخرج" name="gradDate" value={displayData.gradDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="المؤسسة المسلمة" name="issuingInstitution" value={displayData.issuingInstitution} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="خريج مدرسة عليا؟" name="isHigherSchoolGraduate" value={displayData.isHigherSchoolGraduate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="الأول في الدفعة؟" name="isTopOfClass" value={displayData.isTopOfClass} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم وثيقة التفوق" name="topOfClassDocNum" value={displayData.topOfClassDocNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ وثيقة التفوق" name="topOfClassDocDate" value={displayData.topOfClassDocDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="جهة إصدار الوثيقة" name="topOfClassDocIssuer" value={displayData.topOfClassDocIssuer} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="المعدل العام" name="overallGpa" value={displayData.overallGpa} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="علامة المذكرة" name="thesisGrade" value={displayData.thesisGrade} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* كشوف النقاط السنوية */}
                                {selected.academicYears && (
                                    <div className="mb-8 p-5 bg-white border border-gray-200 rounded-2xl shadow-sm text-right">
                                        <h4 className="font-black text-brand mb-4 text-sm flex items-center gap-2 justify-end"><Icons.BookOpen /> المسار الدراسي السنوي</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            {Object.entries(selected.academicYears).map(([k, v]) => (
                                                <div key={k} className="flex justify-between items-center bg-slate-50 p-3 rounded-xl text-sm border border-slate-100 flex-row-reverse">
                                                    <span className="font-black text-slate-700">سنة {k.replace('Year', '')}</span>
                                                    <div className="flex gap-3 text-xs font-bold text-slate-500">
                                                        <span>س1: {v.s1}</span><span>س2: {v.s2}</span>
                                                        <span className="text-white bg-brand px-2 py-0.5 rounded-md">المعدل: {v.ann}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* شهادات عليا أخرى */}
                                {selected.hasOtherDegrees === 'نعم' && (
                                    <Section title="شهادات عليا أخرى" icon={<Icons.GraduationCap />}>
                                        <DataField label="اسم الشهادة" name="otherDegreeName" value={displayData.otherDegreeName} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="التخصص" name="otherDegreeSpecialty" value={displayData.otherDegreeSpecialty} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="الجهة المسلمة" name="otherDegreeIssuer" value={displayData.otherDegreeIssuer} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="عدد السداسيات" name="nmsemester" value={displayData.nmsemester} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="من سنة" name="otherStartYear" value={displayData.otherStartYear} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                        <DataField label="إلى سنة" name="otherEndYear" value={displayData.otherEndYear} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    </Section>
                                )}

                                {/* 5. المنشورات والأعمال المهنية */}
                                <Section title="5. المنشورات والأعمال المهنية" icon={<Icons.BookOpen />}>
                                    <DataField label="طبيعة العمل" name="pubNature" value={displayData.pubNature} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ النشر" name="pubDate" value={displayData.pubDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="المجلة / الملتقى" name="pubJournal" value={displayData.pubJournal} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="العدد / المجلد" name="pubIssue" value={displayData.pubIssue} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رابط النشر" name="pubLink" value={displayData.pubLink} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* 6. الخبرة المهنية المكتسبة */}
                                <Section title="6. الخبرة المهنية المكتسبة" icon={<Icons.Briefcase />}>
                                    <DataField label="فئة الخبرة" name="expType" value={displayData.expType} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="المنصب المشغول" name="expJob" value={displayData.expJob} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="المؤسسة" name="expInstitution" value={displayData.expInstitution} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="نوع الشهادة" name="expCertType" value={displayData.expCertType} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم الشهادة" name="expCertNum" value={displayData.expCertNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ الشهادة" name="expCertDate" value={displayData.expCertDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ البداية" name="expStartDate" value={displayData.expStartDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ النهاية" name="expEndDate" value={displayData.expEndDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="سبب التوقف" name="expTerminationReason" value={displayData.expTerminationReason} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* 7. الوضعية المهنية الحالية */}
                                <Section title="7. الوضعية المهنية الحالية" icon={<Icons.Briefcase />}>
                                    <DataField label="الرتبة الحالية" name="currentJobRank" value={displayData.currentJobRank} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ أول تعيين" name="firstAppointDate" value={displayData.firstAppointDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="تاريخ الرتبة" name="currentRankDate" value={displayData.currentRankDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="الصنف / الدرجة" name="category" value={displayData.category} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="المستوى / الدرجة" name="gradeLevel" value={displayData.gradeLevel} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="رقم المرجع" name="jobRefNum" value={displayData.jobRefNum} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="تاريخ المرجع" name="jobRefDate" value={displayData.jobRefDate} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} type="date" />
                                    <DataField label="صفة السلطة" name="signingAuthority" value={displayData.signingAuthority} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="هاتف الإدارة" name="adminPhone" value={displayData.adminPhone} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="إيميل الإدارة" name="adminEmail" value={displayData.adminEmail} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="اسم الإدارة" name="adminName" value={displayData.adminName} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                    <DataField label="عنوان الإدارة" name="adminAddress" value={displayData.adminAddress} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* 8. بيانات الاتصال النهائية */}
                                <Section title="8. بيانات الاتصال النهائية" icon={<Icons.Mail />}>
                                    <DataField label="البريد الإلكتروني الشخصي" name="email" value={displayData.email} isEditing={isEditing} onEditChange={handleEditChange} onCopy={copyToClipboard} />
                                </Section>

                                {/* 9. بيانات الدخول وملاحظات الإدارة */}
                                <Section title="9. ملاحظات الإدارة وبيانات الدخول" icon={<Icons.Edit />}>
                                    <DataField label="اسم المستخدم (للمنصة)" value={selected.email ? selected.email.split('@')[0] : '---'} onCopy={copyToClipboard} />
                                    <DataField label="كلمة المرور (للمنصة)" value={selected.phone || '---'} onCopy={copyToClipboard} />
                                    <div className="col-span-full">
                                        <div className="bg-white border border-gray-200 p-3 rounded-lg flex flex-col h-full">
                                            <span className="text-xs text-brand font-black mb-1 italic">ملاحظات الإدارة:</span>
                                            {isEditing ? (
                                                <textarea 
                                                    className="w-full bg-slate-50 border border-brand/30 rounded p-2 text-sm font-bold h-24 outline-none focus:border-brand text-right"
                                                    value={displayData.adminNotes || ''}
                                                    placeholder="اكتب ملاحظاتك الإدارية هنا..."
                                                    onChange={(e) => handleEditChange('adminNotes', e.target.value)}
                                                ></textarea>
                                            ) : (
                                                <p className="text-xs font-bold text-slate-600 bg-slate-50 p-2 rounded min-h-[50px] whitespace-pre-wrap">
                                                    {selected.adminNotes || 'لا توجد ملاحظات'}
                                                </p>
                                            )}
                                        </div>
                                    </div>
                                </Section>
                            </div>
                        ) : (
                            <div className="flex flex-col items-center justify-center h-full text-slate-400 select-none opacity-50">
                                <Icons.Briefcase />
                                <p className="font-bold text-xl mt-4">اختر مترشحاً من القائمة الجانبية</p>
                            </div>
                        )}
                    </div>
                    <Toast msg={toast.msg} show={toast.show} type={toast.type} />
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => { setUser(u); setLoading(false); });
                return () => unsub();
            }, []);
            if (loading) return <div className="h-screen flex items-center justify-center"><div className="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-brand"></div></div>;
            return user ? <Dashboard /> : <LoginScreen />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
