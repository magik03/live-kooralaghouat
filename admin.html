<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£Ø¯Ù…Ù† - Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„</title>
    <link rel="icon" href="https://i.top4top.io/p_3636li6n50.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Tajawal', sans-serif; background: #f0f2f5; margin: 0; min-height: 100vh; padding: 10px; padding-bottom: 80px; }
        
        #login-screen { display: flex; flex-direction: column; height: 90vh; justify-content: center; max-width: 400px; margin: 0 auto; }
        .logo-header { width: 90px; height: 90px; border-radius: 50%; border: 3px solid #27ae60; margin: 0 auto 20px; display: block; object-fit: cover; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e1e4e8; }
        
        input, select { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Tajawal'; font-size: 16px; background: #fff; transition: 0.3s; }
        input:focus, select:focus { border-color: #27ae60; outline: none; }
        
        button { width: 100%; padding: 14px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        
        .edit-card { background: #fff; border: 1px solid #d1d5db; border-radius: 12px; padding: 15px; margin-bottom: 15px; position: relative; overflow: hidden; }
        .edit-card::before { content: ''; position: absolute; top: 0; right: 0; width: 100%; height: 6px; background: #3498db; }
        
        .section-label { font-size: 0.85rem; color: #6b7280; font-weight: 700; margin: 15px 0 8px; display: flex; align-items: center; gap: 5px; }
        .team-select-row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .team-img-small { width: 45px; height: 45px; border-radius: 50%; object-fit: contain; border: 1px solid #eee; background: #fff; padding: 2px; }
        
        .name-input { font-weight: bold; background-color: #f9fafb !important; }
        .logo-input { font-size: 0.8rem; color: #888; padding: 8px !important; margin-bottom: 10px; }

        .timer-wrapper { background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px dashed #cbd5e1; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .timer-controls { display: flex; gap: 10px; width: 100%; }
        .btn-control { flex: 1; font-size: 0.9rem; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-start { background: #10b981; }
        .btn-stop { background: #ef4444; }
        
        .time-display-wrapper { display: flex; align-items: center; gap: 5px; font-weight: bold; color: #333; }
        .time-input { width: 70px !important; text-align: center; font-size: 1.3rem; margin: 0; border: 2px solid #e2e8f0; }
        
        .score-edit-row { display: flex; justify-content: center; align-items: center; gap: 15px; background: #f1f5f9; padding: 15px; border-radius: 12px; margin: 15px 0; }
        .score-input { width: 60px !important; text-align: center; font-size: 1.8rem; font-weight: 800; margin: 0; border: 2px solid #cbd5e1; color: #1e293b; }

        .btns-row { display: flex; gap: 10px; margin-top: 20px; }
        .btn-save { background: #3b82f6; flex: 2; }
        .btn-del { background: #ef4444; flex: 1; }
        
        .live-indicator { display: inline-block; width: 10px; height: 10px; background: red; border-radius: 50%; animation: blink 1s infinite; margin-right: 5px; display: none; }
        .live-indicator.active { display: inline-block; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="card" style="text-align:center;">
            <img src="https://i.top4top.io/p_3636li6n50.jpg" class="logo-header">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h3>
            <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="direction: ltr;">
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="direction: ltr;">
            <button id="btnLogin">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="dashboard" style="display:none; max-width: 600px; margin: 0 auto;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0; color:#1f2937;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h3>
            <button onclick="window.location.reload()" style="width:auto; background:#6b7280; padding:8px 20px; font-size:0.9rem;">ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <div class="card" style="border-top: 5px solid #27ae60;">
            <h3 style="margin-top:0; color:#27ae60; font-size:1.1rem;">+ Ù†Ø´Ø± Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <select id="newLeague" onchange="updateClubsList()">
                <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© --</option>
                <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)</option>
                <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)</option>
                <option value="Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)">Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)</option>
                <option value="Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª">Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª</option>
                <option value="Ø´Ø±ÙÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·">Ø´Ø±ÙÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·</option>
                <option value="ÙˆÙ„Ø§Ø¦ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·">ÙˆÙ„Ø§Ø¦ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·</option>
                <option value="ÙƒØ£Ø³ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©">ÙƒØ£Ø³ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ğŸ†</option>
            </select>
            <input type="text" id="newRound" placeholder="Ø§Ù„Ø¬ÙˆÙ„Ø© (Ù…Ø«Ø§Ù„: 14)">
            
            <div style="display:flex; gap:10px;">
                <select id="newHome" class="club-select"><option value="">Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ (ÙŠÙ…ÙŠÙ†)</option></select>
                <select id="newAway" class="club-select"><option value="">Ø§Ù„Ø¶ÙŠÙ (ÙŠØ³Ø§Ø±)</option></select>
            </div>
            <button id="btnAdd">Ù†Ø´Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</button>
        </div>

        <div id="matches-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³
        const firebaseConfig = {
          apiKey: "AIzaSyAXLSZ5OqPEOnP0DUx3w75fU2xxiVkrWcE",
          authDomain: "koooralaghouat.firebaseapp.com",
          projectId: "koooralaghouat",
          storageBucket: "koooralaghouat.firebasestorage.app",
          messagingSenderId: "84750708348",
          appId: "1:84750708348:web:179ec7acf8fc2f357e23f9",
          measurementId: "G-4YSP7SWPGV"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù†Ø¯ÙŠØ©
        window.leaguesData = {
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø£)": [
                { name: "Ø´ Ø¨ Ø¹ÙŠÙ† Ø§Ù…ÙŠÙ†Ø§Ø³", logo: "https://lrfouargla.com/uploads/images/logos/1(1).png" },
                { name: "Ù†.Ø±.ØªÙ‚Ù†ØªÙˆØ±ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/203-1601155957.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø§Ù„ØºØ±Ø§Ø¨Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sssx.png" },
                { name: "Ù… .Ø´Ø¨Ø§Ø¨ .Ø§Ù„Ù…Ø®Ø§Ø¯Ù…Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sz.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø¨Ø±ÙŠØ§Ù†", logo: "https://lrfouargla.com/uploads/images/logos/47.png" },
                { name: "ØªØ±Ø¬ÙŠ ØªÙ‚Ø¯ÙŠØ¯ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/133.png" },
                { name: "Ùˆ.Ø±.Ø¨.Ø§Ù„Ø¯Ø¨ÙŠÙ„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/qqqqqq.png" },
                { name: "Ù†Ø§Ø¯ÙŠ Ø¨ÙˆØºÙØ§Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/23.png" },
                { name: "Ø§Ù„Ù…Ù†Ø¸Ø± Ø§Ù„Ø¬Ù…ÙŠÙ„", logo: "https://lrfouargla.com/uploads/images/logos/CSBV%20(1).png" },
                { name: "Ù….Ùƒ.Ø£Ù…Ù„ Ø§Ù„Ù†Ø²Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/sss%20%E2%80%AB%E2%80%AC.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ø±Ø¨Ø§Ø­", logo: "https://lrfouargla.com/uploads/images/logos/73.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ø³ÙŠØ¯ÙŠ Ø¨ÙˆØ¹Ø²ÙŠØ²", logo: "https://lrfouargla.com/uploads/images/logos/13.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ù‚ØµØ± Ø§Ù„Ø­ÙŠØ±Ø§Ù†", logo: "https://lrfouargla.com/uploads/images/logos/54.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ø¯Ù„Ø§Ø¹Ø©", logo: "https://lrfouargla.com/uploads/images/logos/53.png" }
            ],
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø£ÙˆÙ„ (ÙÙˆØ¬ Ø¨)": [
                { name: "Ø´Ø¨Ø§Ø¨ Ù‚ØµØ± ÙˆØ±Ù‚Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/15826488_199664807171500_3091424271281007906_n.gif" },
                { name: "ÙˆÙØ§Ù‚ Ø§Ù„Ù…ØºÙŠØ±", logo: "https://lrfouargla.com/uploads/images/logos/111.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ .Ø±. Ø¨.Ø§Ù„Ø£ØºÙˆØ§Ø·", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20241109-WA0007.jpg" },
                { name: "ÙˆÙØ§Ù‚ Ø¹ÙŠÙ† Ù…Ø§Ø¶ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/125.png" },
                { name: "Ø£Ù…Ù„ Ø³ÙˆÙ", logo: "https://lrfouargla.com/uploads/images/logos/88.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ù†Ù‡Ù‚Ø§Ø±", logo: "https://lrfouargla.com/uploads/images/logos/102.png" },
                { name: "Ù‡Ù„Ø§Ù„ ØºØ±Ø¯Ø§ÙŠØ©", logo: "https://lrfouargla.com/uploads/images/logos/75.png" },
                { name: "Ø§Ù„ØªØ¶Ø§Ù…Ù† Ø§Ù„Ø³ÙˆÙÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/72.png" },
                { name: "Ø¥. Ø§Ù„Ø±Ø¨Ø§Ø¶ÙŠ Ø§Ù„Ù…Ù†ÙŠØ¹ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/WhatsApp%20Image%202025-10-25%20%C3%A0%2022.02.03_23b4051f.jpg" },
                { name: "Ø´.Ø£.ØªÙ…Ù†Ø±Ø§Ø³Øª", logo: "https://lrfouargla.com/uploads/images/logos/100.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø¹ÙŠÙ† Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡", logo: "https://lrfouargla.com/uploads/images/logos/40.png" },
                { name: "ÙˆÙØ§Ù‚ Ù…Ù‚Ø±", logo: "https://lrfouargla.com/uploads/images/logos/38.png" },
                { name: "Ø¥.Ø§Ù„Ø­Ù…Ø§Ø¯ÙŠÙ†", logo: "https://lrfouargla.com/uploads/images/logos/168-1531611858.png" },
                { name: "Ù†Ø¬Ù… Ø¨ÙˆØºÙØ§Ù„Ø©", logo: "https://lrfouargla.com/uploads/images/logos/NRNBO-02.png" }
            ],
            "Ø§Ù„Ø¬Ù‡ÙˆÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ (ÙÙˆØ¬ Ø¬)": [
                { name: "Ù… .Ø´ .Ø§Ù„Ø«Ù†ÙŠØ© ØºØ±Ø¯Ø§ÙŠØ©", logo: "https://lrfouargla.com/uploads/images/logos/449-1634476753.png" },
                { name: "Ù…ÙˆÙ„ÙˆØ¯ÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡", logo: "https://lrfouargla.com/uploads/images/logos/46.png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ø§Ù„Ù…Ù†ÙŠØ¹Ø©", logo: "https://lrfouargla.com/uploads/images/logos/7.png" },
                { name: "Ø¨Ù† Ù†Ø§ØµØ± Ø¨Ù† Ø´Ù‡Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/49(1).png" },
                { name: "Ø¥.Ø¶Ø§ÙŠØ© Ø¨Ù† Ø¶Ø­ÙˆØ©", logo: "https://lrfouargla.com/uploads/images/logos/57(1).png" },
                { name: "Ù…Ø³ØªÙ‚Ø¨Ù„ Ù„Ù…Ø§Ø¶ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/56.png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ù‚Ø§Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/134.png" },
                { name: "Ø¹ÙŠÙ† Ø³ÙŠØ¯ÙŠ Ø¹Ù„ÙŠ", logo: "https://lrfouargla.com/uploads/images/logos/1528-1663416912.png" },
                { name: "Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø£ØºÙˆØ§Ø·", logo: "https://lrfouargla.com/uploads/images/logos/50.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ ØªØ§Ø¬Ù…ÙˆØª", logo: "https://lrfouargla.com/uploads/images/logos/nirbt.png" },
                { name: "Ø§ØªØ­Ø§Ø¯.Ø¨Ø±ÙŠØ¯Ø©", logo: "https://lrfouargla.com/uploads/images/logos/2174-1665949908.png" },
                { name: "ØªØ±Ø¬ÙŠ Ù…Ø±Ù…Ø§Ø¯", logo: "https://lrfouargla.com/uploads/images/logos/51.png" },
                { name: "ÙˆØ¯Ø§Ø¯ Ø²Ù„ÙØ§Ù†Ø©", logo: "https://lrfouargla.com/uploads/images/logos/t%C3%A9l%C3%A9chargement%20(1).jpg" },
                { name: "Ø§Ù„Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø±Ø©", logo: "https://lrfouargla.com/uploads/images/logos/IMG-20231119-WA0010.jpg" },
                { name: "Ø£Ù…Ù„ Ø³ÙŠØ¯ÙŠ Ø¨ÙˆØ²ÙŠØ¯", logo: "https://lrfouargla.com/uploads/images/logos/49.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø´Ø¨Ø§Ø¨ ØªØ§ØºÙŠØª", logo: "https://lrfouargla.com/uploads/images/logos/1855-1664293222.png" }
            ],
            "Ù‚Ø³Ù… Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø·Ø§Øª": [
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ù†Ø²Ù„Ø©", logo: "https://lirf.org.dz/uploads/images/logos/3.png" },
                { name: "Ù†Ø§Ø¯ÙŠ ØªÙ‚Ø±Øª", logo: "https://lirf.org.dz/uploads/images/logos/received_257439396802495.jpeg" },
                { name: "Ø£ Ù…ØªÙ„ÙŠÙ„ÙŠ Ø§Ù„Ø´Ø¹Ø§Ù†Ø¨Ø©", logo: "https://lirf.org.dz/uploads/images/logos/5.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø®Ù†Ù‚", logo: "https://lirf.org.dz/uploads/images/logos/IRBKheneg.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø§Ù„Ø²Ø§ÙˆÙŠØ©", logo: "https://lirf.org.dz/uploads/images/logos/6.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø¢ÙÙ„Ùˆ", logo: "https://lirf.org.dz/uploads/images/logos/407-1656244680.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ù‡Ù…Ø§ÙŠØ³Ø©", logo: "https://lirf.org.dz/uploads/images/logos/102.png" },
                { name: "Ù…Ø´Ø¹Ù„ Ø­Ø§Ø³ÙŠ Ù…Ø³Ø¹ÙˆØ¯", logo: "https://lirf.org.dz/uploads/images/logos/13.png" },
                { name: "Ø´Ø¨Ø§Ø¨ Ø¬Ø§Ù…Ø¹Ø©", logo: "https://lirf.org.dz/uploads/images/logos/39(1).png" },
                { name: "Ø±Ø§Ø¦Ø¯ Ù‚Ù„ØªØ©Ø³ Ø³Ø¹Ø¯", logo: "https://lirf.org.dz/uploads/images/logos/Gueltet%20Sidi%20Saad.png" },
                { name: "Ø§ÙˆÙ„Ù…Ø¨ÙŠ Ø§Ù„ÙˆØ§Ø¯", logo: "https://lirf.org.dz/uploads/images/logos/Olympique%20El-Oued.png" },
                { name: "Ø£ÙˆÙ„Ù…Ø¨ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø±Ù†", logo: "https://lirf.org.dz/uploads/images/logos/8.png" },
                { name: "Ù†Ø¬ÙˆÙ… Ø§Ù„ÙŠØ²ÙŠ", logo: "https://lirf.org.dz/uploads/images/logos/16.png" },
                { name: "Ø¥ØªØ­Ø§Ø¯ Ø­Ø§Ø³ÙŠ Ø§Ù„Ø±Ù…Ù„", logo: "https://lirf.org.dz/uploads/images/logos/12.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ Ø³ÙˆÙ", logo: "https://lirf.org.dz/uploads/images/logos/412-1715352850.png" },
                { name: "Ø§ØªØ­Ø§Ø¯ ÙˆØ±Ù‚Ù„Ø©", logo: "https://lirf.org.dz/uploads/images/logos/414-1662939264.png" }
            ],
            "default": [ { name: "ÙØ±ÙŠÙ‚ 1", logo: "" }, { name: "ÙØ±ÙŠÙ‚ 2", logo: "" } ]
        };

        window.updateClubsList = () => {
            const league = document.getElementById('newLeague').value;
            const homeSelect = document.getElementById('newHome');
            const awaySelect = document.getElementById('newAway');
            homeSelect.innerHTML = '<option value="">Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ (ÙŠÙ…ÙŠÙ†)</option>';
            awaySelect.innerHTML = '<option value="">Ø§Ù„Ø¶ÙŠÙ (ÙŠØ³Ø§Ø±)</option>';
            const clubs = window.leaguesData[league] || window.leaguesData["default"];
            clubs.forEach(club => {
                const opt1 = document.createElement('option'); opt1.value = club.name; opt1.innerText = club.name; opt1.setAttribute('data-logo', club.logo); homeSelect.appendChild(opt1);
                const opt2 = document.createElement('option'); opt2.value = club.name; opt2.innerText = club.name; opt2.setAttribute('data-logo', club.logo); awaySelect.appendChild(opt2);
            });
        };

        const getLogoFromSelect = (selectId) => {
            const select = document.getElementById(selectId);
            return select.options[select.selectedIndex].getAttribute('data-logo') || 'https://cdn-icons-png.flaticon.com/512/53/53283.png';
        };

        onAuthStateChanged(auth, (user) => {
            document.getElementById('login-screen').style.display = user ? 'none' : 'flex';
            document.getElementById('dashboard').style.display = user ? 'block' : 'none';
            if(user) loadMatches();
        });

        document.getElementById('btnLogin').addEventListener('click', () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value)
            .catch(e => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„"));
        });

        document.getElementById('btnAdd').addEventListener('click', async () => {
            const league = document.getElementById('newLeague').value;
            const round = document.getElementById('newRound').value;
            const home = document.getElementById('newHome').value;
            const away = document.getElementById('newAway').value;
            if(league && home && away) {
                if(confirm("Ù†Ø´Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©ØŸ")) {
                    await addDoc(collection(db, "matches"), {
                        league, round, home, away, homeLogo: getLogoFromSelect('newHome'), awayLogo: getLogoFromSelect('newAway'),
                        scoreH: 0, scoreA: 0, scorersH: "", scorersA: "", 
                        status: "Ù„Ù… ØªØ¨Ø¯Ø£", 
                        elapsedSeconds: 0, 
                        isRunning: false, lastStartTime: null
                    });
                    alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…");
                }
            } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
        });

        function loadMatches() {
            onSnapshot(collection(db, "matches"), (snapshot) => {
                const list = document.getElementById('matches-list');
                list.innerHTML = '';
                snapshot.forEach((d) => {
                    const m = d.data();
                    const id = d.id;
                    const sel = (val) => m.status === val ? 'selected' : '';

                    let currentSeconds = m.elapsedSeconds || 0;
                    if(m.isRunning && m.lastStartTime) {
                        const now = Date.now();
                        currentSeconds += Math.floor((now - m.lastStartTime) / 1000);
                    }
                    const minutes = Math.floor(currentSeconds / 60);

                    // Ø­Ø§Ù„Ø© Ø§Ù„ÙˆÙ…ÙŠØ¶ Ù„Ù„Ù…Ø´Ø±Ù
                    const liveClass = m.isRunning ? 'active' : '';

                    list.innerHTML += `
                    <div class="edit-card">
                        <div style="text-align:center; font-weight:bold; color:#6b7280; margin-bottom:10px;">${m.league}</div>

                        <!-- 1. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ±Ù‚ -->
                        <div class="section-label">Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ (ÙŠÙ…ÙŠÙ†)</div>
                        <div class="team-edit-row">
                            <img src="${m.homeLogo}" class="team-img-small">
                            <input type="text" id="hName-${id}" value="${m.home}" class="name-input">
                        </div>
                        <input type="text" id="hLogo-${id}" value="${m.homeLogo}" class="logo-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±">
                        
                        <div class="score-edit-row">
                            <input type="number" id="sH-${id}" value="${m.scoreH}" class="score-input">
                            <span style="font-weight:bold; color:#aaa;">-</span>
                            <input type="number" id="sA-${id}" value="${m.scoreA}" class="score-input">
                        </div>

                        <div class="section-label">Ø§Ù„Ø¶ÙŠÙ (ÙŠØ³Ø§Ø±)</div>
                        <div class="team-edit-row">
                            <img src="${m.awayLogo}" class="team-img-small">
                            <input type="text" id="aName-${id}" value="${m.away}" class="name-input">
                        </div>
                        <input type="text" id="aLogo-${id}" value="${m.awayLogo}" class="logo-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±">

                         <input type="text" id="scH-${id}" value="${m.scorersH || ''}" placeholder="Ù‡Ø¯Ø§ÙÙŠ Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ" style="font-size:0.8rem; margin-top:5px;">
                         <input type="text" id="scA-${id}" value="${m.scorersA || ''}" placeholder="Ù‡Ø¯Ø§ÙÙŠ Ø§Ù„Ø¶ÙŠÙ" style="font-size:0.8rem; margin-top:5px;">

                        <div class="section-label"><span class="live-indicator ${liveClass}"></span> â±ï¸ Ø§Ù„Ù…Ø¤Ù‚Øª (Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚:Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)</div>
                        <div class="timer-wrapper">
                            <div class="time-display-wrapper">
                                <span>Ø¶Ø¨Ø· Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©:</span>
                                <input type="number" id="tm-set-${id}" value="${minutes}" class="time-input" placeholder="00">
                            </div>
                            <div class="timer-controls">
                                <button class="btn-control btn-start" onclick="window.toggleTimer('${id}', true, ${currentSeconds})" ${m.isRunning ? 'disabled style="opacity:0.5"' : ''}>ØªØ´ØºÙŠÙ„ â–¶</button>
                                <button class="btn-control btn-stop" onclick="window.toggleTimer('${id}', false, ${currentSeconds})" ${!m.isRunning ? 'disabled style="opacity:0.5"' : ''}>Ø¥ÙŠÙ‚Ø§Ù â¸</button>
                            </div>
                            <div class="admin-live-timer" data-running="${m.isRunning}" data-start="${m.lastStartTime}" data-base="${m.elapsedSeconds}" style="font-weight:bold; color:#27ae60; margin-top:5px;">
                                ${Math.floor(currentSeconds / 60).toString().padStart(2,'0')}:${Math.floor(currentSeconds % 60).toString().padStart(2,'0')}
                            </div>
                        </div>
                        
                        <div style="margin-top:10px;">
                            <select id="st-${id}" style="font-weight:bold;">
                                <option value="Ù„Ù… ØªØ¨Ø¯Ø£" ${sel("Ù„Ù… ØªØ¨Ø¯Ø£")}>âšª Ù„Ù… ØªØ¨Ø¯Ø£</option>
                                <option value="Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„" ${sel("Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„")}>ğŸŸ¢ Ø§Ù„Ø´ÙˆØ· 1</option>
                                <option value="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„" ${sel("Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„")}>ğŸŸ  Ø§Ø³ØªØ±Ø§Ø­Ø©</option>
                                <option value="Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ" ${sel("Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ")}>ğŸŸ¢ Ø§Ù„Ø´ÙˆØ· 2</option>
                                <option value="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©" ${sel("Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©")}>âš« Ø§Ù†ØªÙ‡Øª</option>
                            </select>
                        </div>

                        <div class="btns-row">
                            <button class="btn-save" onclick="window.upd('${id}', ${m.isRunning}, ${currentSeconds})">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                            <button class="btn-del" onclick="window.del('${id}')">Ø­Ø°Ù</button>
                        </div>
                    </div>`;
                });
            });
        }

        window.toggleTimer = async (id, start, currentTotalSeconds) => {
            const manualMinutes = Number(document.getElementById(`tm-set-${id}`).value);
            let baseSeconds = currentTotalSeconds;
            const displayedMinutes = Math.floor(currentTotalSeconds / 60);
            
            // Ø¥Ø°Ø§ Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
            if (manualMinutes !== displayedMinutes) {
                baseSeconds = manualMinutes * 60;
            }

            if(start) {
                await updateDoc(doc(db, "matches", id), {
                    isRunning: true, 
                    lastStartTime: Date.now(), 
                    elapsedSeconds: baseSeconds 
                });
            } else {
                await updateDoc(doc(db, "matches", id), {
                    isRunning: false, 
                    lastStartTime: null, 
                    elapsedSeconds: baseSeconds 
                });
            }
        };

        window.upd = async (id, isRunning, currentSeconds) => {
            const status = document.getElementById(`st-${id}`).value;
            let newIsRunning = isRunning;
            let newElapsedSeconds = currentSeconds;

            // âš ï¸ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "Ù†Ù‡Ø§ÙŠØ©..." Ø£Ùˆ "Ø§Ø³ØªØ±Ø§Ø­Ø©"
            if (status.includes("Ù†Ù‡Ø§ÙŠØ©") || status.includes("Ø§Ø³ØªØ±Ø§Ø­Ø©")) {
                newIsRunning = false;
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª ÙŠÙ…Ø´ÙŠØŒ ÙŠØ¬Ø¨ Ø­ÙØ¸ Ù‚ÙŠÙ…ØªÙ‡ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙˆÙ‚Ù
                if(isRunning) {
                    const now = Date.now();
                    // Ù†Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ù‚ Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ´ØºÙŠÙ„ ÙˆÙ†Ø¶ÙŠÙÙ‡ Ù„Ù„Ø£Ø³Ø§Ø³
                    // (Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø­ØªØ§Ø¬ Ù„Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙƒÙˆÙ† Ø¯Ù‚ÙŠÙ‚Ø© 100% Ù„ÙƒÙ† Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ù‡Ù†Ø§ Ø¬ÙŠØ¯)
                    // Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ currentSeconds Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ù€ Snapshot
                }
            }

            let updateData = {
                home: document.getElementById(`hName-${id}`).value,
                away: document.getElementById(`aName-${id}`).value,
                homeLogo: document.getElementById(`hLogo-${id}`).value,
                awayLogo: document.getElementById(`aLogo-${id}`).value,
                scoreH: Number(document.getElementById(`sH-${id}`).value),
                scoreA: Number(document.getElementById(`sA-${id}`).value),
                scorersH: document.getElementById(`scH-${id}`).value,
                scorersA: document.getElementById(`scA-${id}`).value,
                status: status,
                isRunning: newIsRunning // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            };
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ù…ØªÙˆÙ‚ÙØ§Ù‹ (ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©)ØŒ Ù†Ø£Ø®Ø° Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† Ø®Ø§Ù†Ø© Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
            if (!newIsRunning) {
                const manualMinutes = Number(document.getElementById(`tm-set-${id}`).value);
                updateData.elapsedSeconds = manualMinutes * 60;
                updateData.lastStartTime = null; // ØªØµÙÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡
            } 
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø§Ø±ÙŠØ© ÙˆØ¶ØºØ·Ù†Ø§ Ø­ÙØ¸ ÙÙ‚Ø· Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŒ ÙŠØ¨Ù‚Ù‰ Ø§Ù„ÙˆÙ‚Øª ÙƒÙ…Ø§ Ù‡Ùˆ

            await updateDoc(doc(db, "matches", id), updateData);
            alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…");
        };
        
        window.del = async (id) => { if(confirm("Ø­Ø°ÙØŸ")) await deleteDoc(doc(db, "matches", id)); };

        setInterval(() => {
            const timers = document.querySelectorAll('.admin-live-timer');
            const now = Date.now();
            timers.forEach(timer => {
                const isRunning = timer.getAttribute('data-running') === 'true';
                if (isRunning) {
                    const startTime = parseInt(timer.getAttribute('data-start'));
                    const baseSeconds = parseInt(timer.getAttribute('data-base'));
                    const totalSeconds = baseSeconds + (now - startTime) / 1000;
                    const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                    const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
                    timer.innerText = `${m}:${s}`;
                }
            });
        }, 1000);

    </script>
</body>
</html>