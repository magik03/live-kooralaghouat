<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الكرة في الأغواط</title>
    <link rel="icon" href="https://i.top4top.io/p_3636li6n50.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary-green: #006039; --accent-green: #2ecc71; --text-dark: #1f2937; --text-grey: #6b7280; --live-red: #ef4444; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Tajawal', sans-serif; background-color: #f3f4f6; color: var(--text-dark); }

        .navbar { background-color: #fff; padding: 15px 5%; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .logo-area { display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.4rem; color: var(--primary-green); }
        .logo-img { width: 45px; height: 45px; border-radius: 50%; }

        .hero { background: linear-gradient(135deg, var(--primary-green), #004d2e); color: white; text-align: center; padding: 50px 20px; }
        .hero h1 { font-size: 2.2rem; margin-bottom: 10px; font-weight: 800; }
        .hero p { font-size: 1rem; opacity: 0.9; }

        .container { max-width: 1200px; margin: -30px auto 50px; padding: 0 15px; position: relative; z-index: 2; }
        .matches-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }

        .league-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e5e7eb; }
        .league-header { background: #fff; padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: var(--primary-green); }
        .live-badge { background: var(--live-red); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; animation: pulse 1.5s infinite; }

        .match-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; border-bottom: 1px solid #f9fafb; transition: 0.2s; }
        .match-row:last-child { border-bottom: none; }
        
        .team { display: flex; align-items: center; gap: 8px; flex: 1; font-size: 0.9rem; font-weight: 600; color: #374151; }
        .team.away { justify-content: flex-end; }
        .team img { width: 30px; height: 30px; object-fit: contain; }

        .match-center { text-align: center; min-width: 140px; }
        .score-box { background: #f3f4f6; color: var(--text-dark); padding: 4px 12px; border-radius: 6px; font-weight: 800; font-size: 1.2rem; display: inline-block; margin-bottom: 4px; direction: ltr; }
        .score-box.live { background: #dcfce7; color: #166534; }
        
        /* تنسيق الوقت والحالة بجانب بعض */
        .match-status-container { font-size: 0.75rem; color: var(--text-grey); font-weight: bold; display: flex; justify-content: center; gap: 5px; align-items: center; }
        .match-time { direction: ltr; font-variant-numeric: tabular-nums; }
        .match-time.live { color: var(--live-red); }
        .status-text { color: #666; font-size: 0.7rem; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        footer { background: #111827; color: white; padding: 30px 20px; margin-top: 50px; text-align: center; font-size: 0.9rem; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo-area">
            <span>الكرة في ولاية الأغواط</span>
            <img src="https://i.top4top.io/p_3636li6n50.jpg" class="logo-img">
        </div>
    </nav>

    <section class="hero">
        <h1>الكرة في ولاية الأغواط</h1>
        <p>تابع نتائج المباريات وترتيب الفرق لحظة بلحظة</p>
    </section>

    <div class="container">
        <div class="matches-grid" id="matches-container">
            <div style="text-align:center; padding:20px;">جاري تحميل المباريات...</div>
        </div>
    </div>

    <footer><p>جميع الحقوق محفوظة © الكرة في الأغواط 2024</p></footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAXLSZ5OqPEOnP0DUx3w75fU2xxiVkrWcE",
          authDomain: "koooralaghouat.firebaseapp.com",
          projectId: "koooralaghouat",
          storageBucket: "koooralaghouat.firebasestorage.app",
          messagingSenderId: "84750708348",
          appId: "1:84750708348:web:179ec7acf8fc2f357e23f9",
          measurementId: "G-4YSP7SWPGV"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function formatTime(totalSeconds) {
            if (!totalSeconds || isNaN(totalSeconds)) totalSeconds = 0;
            if (totalSeconds < 0) totalSeconds = 0;
            const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        onSnapshot(collection(db, "matches"), (snapshot) => {
            const container = document.getElementById("matches-container");
            container.innerHTML = "";
            
            if(snapshot.empty) {
                container.innerHTML = "<div style='text-align:center; color:#666;'>لا توجد مباريات</div>";
                return;
            }

            const leagues = {};
            snapshot.forEach((doc) => {
                const m = doc.data();
                if (!leagues[m.league]) leagues[m.league] = [];
                leagues[m.league].push(m);
            });

            for (const [leagueName, matches] of Object.entries(leagues)) {
                let cardHtml = `
                <div class="league-card">
                    <div class="league-header">
                        <div><i class="fa-solid fa-trophy"></i> ${leagueName}</div>
                        <span style="font-size:0.8rem; color:#888;">${matches[0].round || 'مباراة'}</span>
                    </div>
                    <div>`;

                matches.forEach(m => {
                    let currentSeconds = m.elapsedSeconds || 0;
                    if(m.isRunning && m.lastStartTime) {
                        const now = Date.now();
                        currentSeconds += (now - m.lastStartTime) / 1000;
                    }

                    // --- منطق العرض الجديد (نص بجوار الوقت) ---
                    let isLive = m.isRunning || m.status.includes("جاري");
                    let statusLabel = ""; // النص الذي يظهر بجانب الوقت
                    let timeDisplay = "";
                    let timeClass = "";
                    let scoreClass = "";
                    let liveBadge = "";
                    let timerData = "";

                    // 1. حالة المباشر (الشوط 1 أو 2)
                    if (isLive) {
                        timeDisplay = formatTime(currentSeconds);
                        timeClass = "live match-timer-active";
                        scoreClass = "live";
                        liveBadge = `<span class="live-badge">مباشر</span>`;
                        
                        // استخراج النص المختصر (شوط 1 / شوط 2)
                        if (m.status.includes("الأول")) statusLabel = "الشوط 1";
                        if (m.status.includes("الثاني")) statusLabel = "الشوط 2";
                        
                        timerData = `data-running="${m.isRunning}" data-start="${m.lastStartTime}" data-base="${m.elapsedSeconds || 0}"`;
                    }
                    // 2. حالة الاستراحة أو النهاية أو لم تبدأ
                    else {
                        if (m.status.includes("استراحة")) statusLabel = "استراحة";
                        else if (m.status.includes("انتهت")) statusLabel = "انتهت";
                        else if (m.status.includes("لم تبدأ")) statusLabel = "لم تبدأ";
                        
                        timeDisplay = ""; // لا نعرض الوقت الرقمي في هذه الحالات (أو يمكن عرض --:--)
                    }

                    cardHtml += `
                        <div class="match-row">
                            <div class="team home">
                                <img src="${m.homeLogo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
                                <span>${m.home}</span>
                            </div>
                            <div class="match-center">
                                ${liveBadge}
                                <div class="score-box ${scoreClass}">${m.scoreA} - ${m.scoreH}</div>
                                <div class="match-status-container">
                                    <span class="match-time ${timeClass}" ${timerData}>${timeDisplay}</span>
                                    <span class="status-text">${statusLabel}</span>
                                </div>
                            </div>
                            <div class="team away">
                                <span>${m.away}</span>
                                <img src="${m.awayLogo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/53/53283.png'">
                            </div>
                        </div>`;
                });

                cardHtml += `</div></div>`;
                container.innerHTML += cardHtml;
            }
        });

        // العداد المحلي
        setInterval(() => {
            const timers = document.querySelectorAll('.match-timer-active');
            const now = Date.now();
            timers.forEach(timer => {
                const isRunning = timer.getAttribute('data-running') === 'true';
                if (isRunning) {
                    const startTime = parseInt(timer.getAttribute('data-start'));
                    let baseSeconds = parseInt(timer.getAttribute('data-base'));
                    if (isNaN(baseSeconds)) baseSeconds = 0;
                    if (!isNaN(startTime)) {
                        const diffSeconds = (now - startTime) / 1000;
                        const totalSeconds = baseSeconds + diffSeconds;
                        timer.innerText = formatTime(totalSeconds);
                    }
                }
            });
        }, 1000);
    </script>
</body>
</html>